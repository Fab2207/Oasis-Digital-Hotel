<!DOCTYPE html>
<html class="dark" lang="es" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="fragments/common :: head"></head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-gray-900 dark:text-gray-100 overflow-hidden"
  >
    <div class="flex h-screen w-full overflow-hidden">
      <!-- SideNavBar -->
      <aside th:replace="fragments/common :: sidebar"></aside>

      <div class="flex-1 flex flex-col min-w-0 overflow-hidden relative">
        <!-- Background Elements -->
        <div
          class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none"
        >
          <div
            class="absolute top-[-10%] right-[-5%] w-[500px] h-[500px] rounded-full bg-primary/5 blur-[100px]"
          ></div>
          <div
            class="absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] rounded-full bg-accent/5 blur-[100px]"
          ></div>
        </div>

        <!-- Top Header -->
        <header th:replace="fragments/common :: navbar"></header>

        <!-- Main Content -->
        <main class="flex-1 p-8 overflow-y-auto scroll-smooth">
          <div class="mx-auto max-w-5xl">
            <!-- PageHeading -->
            <div class="flex flex-wrap justify-between gap-3 mb-8">
              <div class="flex flex-col gap-1">
                <h1 class="text-white text-3xl font-bold tracking-tight">
                  Configuración del Sistema
                </h1>
                <p class="text-white/60 text-base font-medium">
                  Administra las preferencias generales, seguridad y
                  personalización.
                </p>
              </div>
            </div>

            <!-- Navigation Tabs -->
            <div
              class="flex overflow-x-auto border-b border-white/10 mb-8 gap-2"
            >
              <button
                id="nav-general"
                onclick="showSection('general')"
                class="px-6 py-3 text-white/60 font-medium hover:text-white hover:bg-white/5 rounded-t-lg transition-all relative group"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg"
                    >settings</span
                  >
                  General
                </span>
                <span
                  class="absolute bottom-0 left-0 w-full h-0.5 bg-primary scale-x-0 group-[.active]:scale-x-100 transition-transform"
                ></span>
              </button>
              <button
                id="nav-seguridad"
                onclick="showSection('seguridad')"
                class="px-6 py-3 text-white/60 font-medium hover:text-white hover:bg-white/5 rounded-t-lg transition-all relative group"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg"
                    >security</span
                  >
                  Seguridad
                </span>
                <span
                  class="absolute bottom-0 left-0 w-full h-0.5 bg-primary scale-x-0 group-[.active]:scale-x-100 transition-transform"
                ></span>
              </button>
              <button
                id="nav-notificaciones"
                onclick="showSection('notificaciones')"
                class="px-6 py-3 text-white/60 font-medium hover:text-white hover:bg-white/5 rounded-t-lg transition-all relative group"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg"
                    >notifications</span
                  >
                  Notificaciones
                </span>
                <span
                  class="absolute bottom-0 left-0 w-full h-0.5 bg-primary scale-x-0 group-[.active]:scale-x-100 transition-transform"
                ></span>
              </button>
              <button
                id="nav-personalizacion"
                onclick="showSection('personalizacion')"
                class="px-6 py-3 text-white/60 font-medium hover:text-white hover:bg-white/5 rounded-t-lg transition-all relative group"
              >
                <span class="flex items-center gap-2">
                  <span class="material-symbols-outlined text-lg">palette</span>
                  Personalización
                </span>
                <span
                  class="absolute bottom-0 left-0 w-full h-0.5 bg-primary scale-x-0 group-[.active]:scale-x-100 transition-transform"
                ></span>
              </button>
            </div>

            <!-- General Settings Section -->
            <div id="section-general" class="animate-fade-in">
              <section class="flex flex-col gap-6">
                <form
                  th:action="@{/configuracion/guardar}"
                  th:object="${configuracion}"
                  method="post"
                >
                  <div
                    class="glass-panel rounded-2xl p-8 border border-white/10 shadow-xl"
                  >
                    <h3
                      class="text-xl font-bold text-white mb-6 flex items-center gap-2"
                    >
                      <span class="p-2 rounded-lg bg-primary/10 text-primary">
                        <span class="material-symbols-outlined">domain</span>
                      </span>
                      Información del Hotel
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div class="space-y-1.5">
                        <label
                          class="text-xs font-bold text-white/60 uppercase tracking-wider ml-1"
                          >Nombre del Hotel</label
                        >
                        <input
                          th:field="*{nombreHotel}"
                          class="w-full rounded-lg bg-black/20 border border-white/10 text-white placeholder:text-white/20 focus:ring-2 focus:ring-primary/50 focus:border-primary/50 focus:bg-black/40 transition-all duration-300"
                          value="Oasis Digital Resort"
                        />
                      </div>
                      <div class="space-y-1.5">
                        <label
                          class="text-xs font-bold text-white/60 uppercase tracking-wider ml-1"
                          >Email de Contacto</label
                        >
                        <input
                          th:field="*{emailContacto}"
                          class="w-full rounded-lg bg-black/20 border border-white/10 text-white placeholder:text-white/20 focus:ring-2 focus:ring-primary/50 focus:border-primary/50 focus:bg-black/40 transition-all duration-300"
                          type="email"
                          value="contacto@oasisdigital.com"
                        />
                      </div>
                      <div class="space-y-1.5 md:col-span-2">
                        <label
                          class="text-xs font-bold text-white/60 uppercase tracking-wider ml-1"
                          >Dirección</label
                        >
                        <textarea
                          th:field="*{direccion}"
                          class="w-full rounded-lg bg-black/20 border border-white/10 text-white placeholder:text-white/20 focus:ring-2 focus:ring-primary/50 focus:border-primary/50 focus:bg-black/40 transition-all duration-300 min-h-[100px]"
                        >
Av. del Sol 123, Cancún, México</textarea
                        >
                      </div>
                    </div>

                    <div
                      class="mt-8 flex justify-end pt-6 border-t border-white/5"
                    >
                      <button
                        type="submit"
                        class="px-6 py-2.5 rounded-lg bg-primary text-white font-bold hover:bg-primary/90 transition-all duration-200 shadow-lg shadow-primary/20 hover:scale-105"
                      >
                        Guardar Cambios
                      </button>
                    </div>
                  </div>
                </form>
              </section>
            </div>

            <!-- Seguridad Section -->
            <div id="section-seguridad" class="hidden-section animate-fade-in">
              <div class="flex flex-col gap-6">
                <!-- Gestión de Usuarios -->
                <div
                  class="glass-panel rounded-2xl p-8 border border-white/10 shadow-xl"
                >
                  <div class="flex items-center justify-between mb-6">
                    <h3
                      class="text-xl font-bold text-white flex items-center gap-2"
                    >
                      <span class="p-2 rounded-lg bg-primary/10 text-primary">
                        <span class="material-symbols-outlined">group_add</span>
                      </span>
                      Gestión de Usuarios y Roles
                    </h3>
                  </div>

                  <div
                    class="overflow-hidden rounded-xl border border-white/5 bg-black/20"
                  >
                    <table class="w-full text-left border-collapse">
                      <thead
                        class="bg-white/5 text-xs text-white/40 uppercase tracking-wider font-medium"
                      >
                        <tr>
                          <th class="px-6 py-4">Usuario</th>
                          <th class="px-6 py-4">Rol Actual</th>
                          <th class="px-6 py-4">Estado</th>
                          <th class="px-6 py-4 text-right">Acciones</th>
                        </tr>
                      </thead>
                      <tbody class="divide-y divide-white/5">
                        <tr
                          th:each="usuario : ${usuarios}"
                          class="hover:bg-white/5 transition-colors group"
                        >
                          <td class="px-6 py-4">
                            <div class="flex items-center gap-3">
                              <div
                                class="size-8 rounded-full bg-white/10 flex items-center justify-center text-white/60"
                              >
                                <span class="material-symbols-outlined text-lg"
                                  >person</span
                                >
                              </div>
                              <span
                                class="font-bold text-white"
                                th:text="${usuario.username}"
                                >admin</span
                              >
                            </div>
                          </td>
                          <td class="px-6 py-4">
                            <span
                              class="text-white/80"
                              th:text="${usuario.rol == 'ROLE_ADMIN' ? 'Administrador' : (usuario.rol == 'ROLE_RECEPCIONISTA' ? 'Recepcionista' : 'Cliente')}"
                              >Administrador</span
                            >
                          </td>
                          <td class="px-6 py-4">
                            <span
                              th:if="${usuario.activo}"
                              class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold bg-green-500/10 text-green-400 border border-green-500/20"
                            >
                              <span
                                class="size-1.5 rounded-full bg-green-400"
                              ></span>
                              Activo
                            </span>
                            <span
                              th:unless="${usuario.activo}"
                              class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold bg-red-500/10 text-red-400 border border-red-500/20"
                            >
                              <span
                                class="size-1.5 rounded-full bg-red-400"
                              ></span>
                              Inactivo
                            </span>
                          </td>
                          <td class="px-6 py-4 text-right">
                            <form
                              th:if="${usuario.username != 'admin'}"
                              th:action="@{/configuracion/usuario/toggle-estado}"
                              method="post"
                              class="inline"
                            >
                              <input
                                type="hidden"
                                name="username"
                                th:value="${usuario.username}"
                              />
                              <button
                                type="submit"
                                class="p-2 rounded-lg hover:bg-white/10 transition-colors"
                                th:classappend="${usuario.activo ? 'text-red-400' : 'text-green-400'}"
                                th:title="${usuario.activo ? 'Bloquear Usuario' : 'Desbloquear Usuario'}"
                              >
                                <span
                                  class="material-symbols-outlined"
                                  th:text="${usuario.activo ? 'block' : 'check_circle'}"
                                  >block</span
                                >
                              </button>
                            </form>
                          </td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(usuarios)}">
                          <td
                            colspan="4"
                            class="px-6 py-12 text-center text-white/30 flex flex-col items-center gap-2"
                          >
                            <span
                              class="material-symbols-outlined text-4xl opacity-50"
                              >group_off</span
                            >
                            No hay usuarios registrados.
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Notificaciones Section -->
            <div
              id="section-notificaciones"
              class="hidden-section animate-fade-in"
            >
              <div class="flex flex-col gap-6">
                <!-- Lista Detallada de Notificaciones -->
                <div
                  class="glass-panel rounded-2xl overflow-hidden border border-white/10 shadow-xl"
                >
                  <div
                    class="p-6 border-b border-white/10 flex justify-between items-center bg-white/5"
                  >
                    <h3
                      class="text-xl font-bold text-white flex items-center gap-2"
                    >
                      <span class="p-2 rounded-lg bg-primary/10 text-primary">
                        <span class="material-symbols-outlined"
                          >notifications_active</span
                        >
                      </span>
                      Historial de Actividad
                    </h3>
                    <button
                      class="text-sm text-primary hover:text-white font-medium transition-colors"
                    >
                      Marcar todas como leídas
                    </button>
                  </div>
                  <div class="divide-y divide-white/5">
                    <div
                      th:each="notificacion : ${notificaciones}"
                      class="p-4 hover:bg-white/5 transition-colors flex gap-4 items-start group"
                    >
                      <!-- Icon based on type -->
                      <div
                        class="size-10 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg"
                        th:classappend="${notificacion.tipo == 'RESERVA' ? 'bg-blue-500/20 text-blue-400 shadow-blue-500/10' : 
                                             (notificacion.tipo == 'CHECKIN' ? 'bg-green-500/20 text-green-400 shadow-green-500/10' : 
                                             (notificacion.tipo == 'CHECKOUT' ? 'bg-red-500/20 text-red-400 shadow-red-500/10' : 'bg-yellow-500/20 text-yellow-400 shadow-yellow-500/10'))}"
                      >
                        <span
                          class="material-symbols-outlined"
                          th:text="${notificacion.tipo == 'RESERVA' ? 'calendar_add_on' : 
                                                                             (notificacion.tipo == 'CHECKIN' ? 'login' : 
                                                                             (notificacion.tipo == 'CHECKOUT' ? 'logout' : 'notifications'))}"
                        ></span>
                      </div>
                      <div class="flex-1">
                        <div class="flex justify-between items-start">
                          <h4
                            class="text-white font-bold text-sm group-hover:text-primary transition-colors"
                            th:text="${notificacion.titulo}"
                          >
                            Titulo
                          </h4>
                          <span
                            class="text-xs text-white/40 font-mono"
                            th:text="${notificacion.tiempoRelativo}"
                            >Hace 5 min</span
                          >
                        </div>
                        <p
                          class="text-white/60 text-sm mt-1"
                          th:text="${notificacion.mensaje}"
                        >
                          Mensaje
                        </p>
                      </div>
                    </div>
                    <div
                      th:if="${#lists.isEmpty(notificaciones)}"
                      class="p-12 text-center text-white/30 flex flex-col items-center gap-2"
                    >
                      <span
                        class="material-symbols-outlined text-4xl opacity-50"
                        >notifications_off</span
                      >
                      No hay notificaciones recientes.
                    </div>
                  </div>
                  <div
                    class="p-4 text-center border-t border-white/5 bg-white/5"
                  >
                    <button
                      class="text-xs font-bold uppercase tracking-wider text-white/40 hover:text-white transition-colors"
                    >
                      Cargar notificaciones antiguas
                    </button>
                  </div>
                </div>

                <!-- Configuración de Alertas -->
                <div
                  class="glass-panel rounded-2xl p-8 border border-white/10 shadow-xl"
                >
                  <h3
                    class="text-xl font-bold text-white mb-6 flex items-center gap-2"
                  >
                    <span class="p-2 rounded-lg bg-primary/10 text-primary">
                      <span class="material-symbols-outlined">tune</span>
                    </span>
                    Preferencias de Alerta
                  </h3>
                  <div class="space-y-4">
                    <label
                      class="flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/5 hover:border-primary/30 transition-colors cursor-pointer group"
                    >
                      <span
                        class="text-white font-medium group-hover:text-primary transition-colors"
                        >Notificar nuevas reservas por Email</span
                      >
                      <input
                        type="checkbox"
                        checked
                        class="rounded bg-black/40 border-white/20 text-primary focus:ring-primary size-5"
                      />
                    </label>
                    <label
                      class="flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/5 hover:border-primary/30 transition-colors cursor-pointer group"
                    >
                      <span
                        class="text-white font-medium group-hover:text-primary transition-colors"
                        >Alertas de seguridad (Intentos fallidos)</span
                      >
                      <input
                        type="checkbox"
                        checked
                        class="rounded bg-black/40 border-white/20 text-primary focus:ring-primary size-5"
                      />
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Personalización Section -->
            <div
              id="section-personalizacion"
              class="hidden-section animate-fade-in"
            >
              <div class="flex flex-col gap-6">
                <div
                  class="glass-panel rounded-2xl p-8 border border-white/10 shadow-xl"
                >
                  <h3
                    class="text-xl font-bold text-white mb-6 flex items-center gap-2"
                  >
                    <span class="p-2 rounded-lg bg-primary/10 text-primary">
                      <span class="material-symbols-outlined">palette</span>
                    </span>
                    Diseño y Funcionalidad
                  </h3>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div>
                      <p
                        class="text-white font-bold mb-4 text-sm uppercase tracking-wider opacity-80"
                      >
                        Color de Acento Principal
                      </p>
                      <div class="flex gap-4 flex-wrap">
                        <!-- Green (Default) -->
                        <button
                          onclick="setTheme('#047857', '#D4AF37')"
                          class="group relative size-14 rounded-2xl bg-[#047857] border-2 border-transparent hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-white ring-offset-2 ring-offset-[#121212] shadow-lg shadow-[#047857]/30"
                          title="Verde Esmeralda"
                        >
                          <span
                            class="absolute inset-0 flex items-center justify-center opacity-0 group-focus:opacity-100 text-white"
                          >
                            <span class="material-symbols-outlined">check</span>
                          </span>
                        </button>
                        <!-- Royal Blue -->
                        <button
                          onclick="setTheme('#2563EB', '#F59E0B')"
                          class="group relative size-14 rounded-2xl bg-[#2563EB] border-2 border-transparent hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-white ring-offset-2 ring-offset-[#121212] shadow-lg shadow-[#2563EB]/30"
                          title="Azul Real"
                        >
                          <span
                            class="absolute inset-0 flex items-center justify-center opacity-0 group-focus:opacity-100 text-white"
                          >
                            <span class="material-symbols-outlined">check</span>
                          </span>
                        </button>
                        <!-- Vibrant Violet -->
                        <button
                          onclick="setTheme('#7C3AED', '#F472B6')"
                          class="group relative size-14 rounded-2xl bg-[#7C3AED] border-2 border-transparent hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-white ring-offset-2 ring-offset-[#121212] shadow-lg shadow-[#7C3AED]/30"
                          title="Violeta Vibrante"
                        >
                          <span
                            class="absolute inset-0 flex items-center justify-center opacity-0 group-focus:opacity-100 text-white"
                          >
                            <span class="material-symbols-outlined">check</span>
                          </span>
                        </button>
                        <!-- Luxury Gold -->
                        <button
                          onclick="setTheme('#D4AF37', '#121212')"
                          class="group relative size-14 rounded-2xl bg-[#D4AF37] border-2 border-transparent hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-white ring-offset-2 ring-offset-[#121212] shadow-lg shadow-[#D4AF37]/30"
                          title="Dorado Lujo"
                        >
                          <span
                            class="absolute inset-0 flex items-center justify-center opacity-0 group-focus:opacity-100 text-white"
                          >
                            <span class="material-symbols-outlined">check</span>
                          </span>
                        </button>
                        <!-- Rojo Vibrante -->
                        <button
                          onclick="setTheme('#EF4444', '#F87171')"
                          class="group relative size-14 rounded-2xl bg-[#EF4444] border-2 border-transparent hover:scale-110 transition-all focus:outline-none focus:ring-2 focus:ring-white ring-offset-2 ring-offset-[#121212] shadow-lg shadow-[#EF4444]/30"
                          title="Rojo Vibrante"
                        >
                          <span
                            class="absolute inset-0 flex items-center justify-center opacity-0 group-focus:opacity-100 text-white"
                          >
                            <span class="material-symbols-outlined">check</span>
                          </span>
                        </button>
                      </div>
                    </div>

                    <div>
                      <p
                        class="text-white font-bold mb-4 text-sm uppercase tracking-wider opacity-80"
                      >
                        Estilo de Bordes
                      </p>
                      <div class="relative">
                        <select
                          onchange="setBorder(this.value)"
                          class="w-full rounded-xl bg-black/20 border border-white/10 text-white focus:ring-2 focus:ring-primary/50 focus:border-primary/50 transition-all duration-300 p-3 [&>option]:bg-[#121212]"
                        >
                          <option value="0.5rem">Redondeados (Default)</option>
                          <option value="0px">Cuadrados</option>
                          <option value="9999px">Píldora</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>

                <div
                  class="glass-panel rounded-2xl p-8 border border-white/10 shadow-xl"
                >
                  <h3
                    class="text-xl font-bold text-white mb-6 flex items-center gap-2"
                  >
                    <span class="p-2 rounded-lg bg-primary/10 text-primary">
                      <span class="material-symbols-outlined">web</span>
                    </span>
                    Contenido del Sitio
                  </h3>
                  <div class="space-y-6">
                    <div class="space-y-1.5">
                      <span
                        class="text-xs font-bold text-white/60 uppercase tracking-wider ml-1"
                        >Mensaje de Bienvenida (Dashboard)</span
                      >
                      <input
                        type="text"
                        class="w-full rounded-lg bg-black/20 border border-white/10 text-white placeholder:text-white/20 focus:ring-2 focus:ring-primary/50 focus:border-primary/50 focus:bg-black/40 transition-all duration-300"
                        value="Bienvenido al Panel de Administración"
                      />
                    </div>
                    <div class="space-y-1.5">
                      <span
                        class="text-xs font-bold text-white/60 uppercase tracking-wider ml-1"
                        >URL del Logo</span
                      >
                      <input
                        type="text"
                        class="w-full rounded-lg bg-black/20 border border-white/10 text-white placeholder:text-white/20 focus:ring-2 focus:ring-primary/50 focus:border-primary/50 focus:bg-black/40 transition-all duration-300"
                        value="https://lh3.googleusercontent.com/..."
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <style>
      .hidden-section {
        display: none;
      }
      .animate-fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>

    <script>
      function showSection(sectionId) {
        // Hide all sections
        document
          .querySelectorAll('[id^="section-"]')
          .forEach((el) => el.classList.add("hidden-section"));

        // Show selected section
        document
          .getElementById("section-" + sectionId)
          .classList.remove("hidden-section");

        // Update nav styles
        document.querySelectorAll('[id^="nav-"]').forEach((el) => {
          el.classList.remove("active", "text-white");
          el.classList.add("text-white/60");

          if (el.id === "nav-" + sectionId) {
            el.classList.add("active", "text-white");
            el.classList.remove("text-white/60");
          }
        });
      }

      function setTheme(primary, accent) {
        const currentBorder = localStorage.getItem("theme-border") || "0.5rem";
        if (window.setAppTheme) {
          window.setAppTheme(primary, accent, currentBorder);
        } else {
          console.error("Theme function not found");
        }
      }

      function setBorder(radius) {
        const currentPrimary =
          localStorage.getItem("theme-primary") || "#047857";
        const currentAccent = localStorage.getItem("theme-accent") || "#D4AF37";
        if (window.setAppTheme) {
          window.setAppTheme(currentPrimary, currentAccent, radius);
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        const hash = window.location.hash;
        if (hash) {
          const section = hash.replace("#section-", "");
          if (
            [
              "general",
              "seguridad",
              "notificaciones",
              "personalizacion",
            ].includes(section)
          ) {
            showSection(section);
          } else {
            showSection("general");
          }
        } else {
          showSection("general");
        }
      });
    </script>
  </body>
</html>
