<!DOCTYPE html>
<html class="dark" lang="es" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="fragments/common :: head"></head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-gray-900 dark:text-gray-100 overflow-hidden"
  >
    <div class="flex h-screen w-full overflow-hidden">
      <!-- SideNavBar -->
      <aside th:replace="fragments/common :: sidebar"></aside>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col min-w-0 overflow-hidden relative">
        <!-- Background Elements -->
        <div
          class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none"
        >
          <div
            class="absolute top-[-10%] right-[-5%] w-[500px] h-[500px] rounded-full bg-primary/5 blur-[100px]"
          ></div>
          <div
            class="absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] rounded-full bg-accent/5 blur-[100px]"
          ></div>
        </div>

        <!-- Top Header -->
        <header th:replace="fragments/common :: navbar"></header>

        <!-- Scrollable Content -->
        <main class="flex-1 overflow-y-auto p-8 scroll-smooth">
          <!-- Stats -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div
              class="glass-card rounded-2xl p-6 relative overflow-hidden group"
            >
              <div
                class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"
              >
                <span class="material-symbols-outlined text-6xl text-primary"
                  >bed</span
                >
              </div>
              <div class="flex flex-col gap-1 relative z-10">
                <p
                  class="text-white/60 text-sm font-medium uppercase tracking-wider"
                >
                  Ocupación Actual
                </p>
                <div class="flex items-baseline gap-2 mt-2">
                  <p
                    class="text-white text-4xl font-bold tracking-tight"
                    th:text="${(habitacionesOcupadas * 100) / (totalHabitaciones > 0 ? totalHabitaciones : 1)} + '%'"
                  >
                    0%
                  </p>
                  <span
                    class="text-primary text-sm font-bold bg-primary/10 px-2 py-0.5 rounded-full border border-primary/20"
                  >
                    <span th:text="${habitacionesOcupadas}">0</span>/<span
                      th:text="${totalHabitaciones}"
                      >0</span
                    >
                  </span>
                </div>
                <p class="text-white/40 text-xs mt-2">Habitaciones ocupadas</p>
              </div>
            </div>

            <div
              class="glass-card rounded-2xl p-6 relative overflow-hidden group"
            >
              <div
                class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"
              >
                <span class="material-symbols-outlined text-6xl text-accent"
                  >payments</span
                >
              </div>
              <div class="flex flex-col gap-1 relative z-10">
                <p
                  class="text-white/60 text-sm font-medium uppercase tracking-wider"
                >
                  Ingresos Totales
                </p>
                <div class="flex items-baseline gap-2 mt-2">
                  <p
                    class="text-white text-4xl font-bold tracking-tight"
                    th:text="'S/. ' + ${ingresosTotales}"
                  >
                    S/. 0.00
                  </p>
                </div>
                <p class="text-white/40 text-xs mt-2">Acumulado histórico</p>
              </div>
            </div>

            <div
              class="glass-card rounded-2xl p-6 relative overflow-hidden group"
            >
              <div
                class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"
              >
                <span class="material-symbols-outlined text-6xl text-blue-400"
                  >login</span
                >
              </div>
              <div class="flex flex-col gap-1 relative z-10">
                <p
                  class="text-white/60 text-sm font-medium uppercase tracking-wider"
                >
                  Flujo de Hoy
                </p>
                <div class="flex items-center gap-8 mt-2">
                  <div>
                    <p
                      class="text-2xl font-bold text-white"
                      th:text="${checkInsHoy}"
                    >
                      0
                    </p>
                    <p class="text-xs text-white/40 uppercase">Check-ins</p>
                  </div>
                  <div class="w-px h-8 bg-white/10"></div>
                  <div>
                    <p
                      class="text-2xl font-bold text-white"
                      th:text="${checkOutsHoy}"
                    >
                      0
                    </p>
                    <p class="text-xs text-white/40 uppercase">Check-outs</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Charts -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
            <div class="lg:col-span-2 glass-panel rounded-2xl p-6">
              <div class="flex justify-between items-start mb-6">
                <div>
                  <h3 class="text-lg font-bold text-white">
                    Tendencia de Ingresos
                  </h3>
                  <p class="text-sm text-white/40">Últimos 30 días</p>
                </div>
                <div
                  class="flex items-center gap-2 bg-primary/10 px-3 py-1 rounded-full border border-primary/20"
                >
                  <span class="material-symbols-outlined text-primary text-sm"
                    >trending_up</span
                  >
                  <span class="text-sm font-bold text-primary">+8.2%</span>
                </div>
              </div>
              <div class="relative h-[300px] w-full">
                <canvas id="ingresosChart"></canvas>
              </div>
            </div>

            <div class="glass-panel rounded-2xl p-6 flex flex-col">
              <h3 class="text-lg font-bold text-white mb-2">Distribución</h3>
              <div
                class="relative flex-1 flex items-center justify-center min-h-[200px]"
              >
                <canvas id="habitacionesChart"></canvas>
                <div
                  class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none"
                >
                  <span
                    class="text-4xl font-black text-white"
                    th:text="${habitacionesOcupadas}"
                    >0</span
                  >
                  <span class="text-xs text-white/40 uppercase tracking-widest"
                    >Ocupadas</span
                  >
                </div>
              </div>
              <div class="grid grid-cols-2 gap-3 mt-4">
                <div class="flex items-center gap-2 bg-white/5 p-2 rounded-lg">
                  <span
                    class="w-2 h-2 rounded-full bg-primary shadow-[0_0_8px_var(--color-primary)]"
                  ></span>
                  <span class="text-xs text-white/70">Ocupadas</span>
                </div>
                <div class="flex items-center gap-2 bg-white/5 p-2 rounded-lg">
                  <span
                    class="w-2 h-2 rounded-full bg-accent shadow-[0_0_8px_var(--color-accent)]"
                  ></span>
                  <span class="text-xs text-white/70">Mantenimiento</span>
                </div>
                <div
                  class="flex items-center gap-2 bg-white/5 p-2 rounded-lg col-span-2"
                >
                  <span class="w-2 h-2 rounded-full bg-white/20"></span>
                  <span class="text-xs text-white/70">Disponibles</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Table -->
          <div class="mt-8">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-bold text-white">Últimas Reservas</h2>
              <a
                href="/reservas"
                class="text-sm text-primary hover:text-primary/80 font-medium flex items-center gap-1 transition-colors"
              >
                Ver todas
                <span class="material-symbols-outlined text-sm"
                  >arrow_forward</span
                >
              </a>
            </div>

            <div class="glass-panel rounded-2xl overflow-hidden">
              <div class="overflow-x-auto">
                <table class="w-full text-sm text-left">
                  <thead
                    class="bg-white/5 text-xs text-white/40 uppercase tracking-wider font-medium"
                  >
                    <tr>
                      <th class="px-6 py-4">Huésped</th>
                      <th class="px-6 py-4">Check-in</th>
                      <th class="px-6 py-4">Check-out</th>
                      <th class="px-6 py-4">Habitación</th>
                      <th class="px-6 py-4">Estado</th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-white/5">
                    <tr
                      th:each="reserva : ${ultimasReservas}"
                      class="hover:bg-white/5 transition-colors group"
                    >
                      <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                          <div
                            class="size-8 rounded-full bg-gradient-to-br from-gray-700 to-gray-900 flex items-center justify-center text-xs font-bold text-white border border-white/10"
                          >
                            <span
                              th:text="${#strings.substring(reserva.cliente.nombres,0,1)}"
                              >C</span
                            >
                          </div>
                          <span
                            class="font-medium text-white group-hover:text-primary transition-colors"
                            th:text="${reserva.cliente.nombres}"
                            >Cliente</span
                          >
                        </div>
                      </td>
                      <td
                        class="px-6 py-4 text-white/60"
                        th:text="${#temporals.format(reserva.fechaInicio, 'dd MMM, yyyy')}"
                      >
                        15 Ago
                      </td>
                      <td
                        class="px-6 py-4 text-white/60"
                        th:text="${#temporals.format(reserva.fechaFin, 'dd MMM, yyyy')}"
                      >
                        20 Ago
                      </td>
                      <td class="px-6 py-4">
                        <span
                          class="text-white/80 font-mono bg-white/5 px-2 py-1 rounded text-xs"
                          th:text="${reserva.habitacion.numero}"
                          >101</span
                        >
                        <span
                          class="text-white/40 text-xs ml-1"
                          th:text="${reserva.habitacion.tipo}"
                          >Suite</span
                        >
                      </td>
                      <td class="px-6 py-4">
                        <span
                          class="px-3 py-1 text-xs font-bold rounded-full border"
                          th:classappend="${reserva.estadoReserva == 'ACTIVA' ? 'text-green-400 bg-green-400/10 border-green-400/20' : 
                              (reserva.estadoReserva == 'PENDIENTE' ? 'text-yellow-400 bg-yellow-400/10 border-yellow-400/20' : 
                              (reserva.estadoReserva == 'FINALIZADA' ? 'text-gray-400 bg-gray-400/10 border-gray-400/20' : 'text-red-400 bg-red-400/10 border-red-400/20'))}"
                          th:text="${reserva.estadoReserva}"
                          >Confirmada</span
                        >
                      </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(ultimasReservas)}">
                      <td
                        colspan="5"
                        class="px-6 py-12 text-center text-white/30 flex flex-col items-center gap-2"
                      >
                        <span
                          class="material-symbols-outlined text-4xl opacity-50"
                          >event_busy</span
                        >
                        No hay reservas recientes.
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
      document.addEventListener("DOMContentLoaded", function () {
        // Charts
        const total = /*[[${totalHabitaciones}]]*/ 1;
        const ocupadas = /*[[${habitacionesOcupadas}]]*/ 0;
        const mantenimiento = /*[[${habitacionesMantenimiento}]]*/ 0;
        const disponibles = /*[[${habitacionesDisponibles}]]*/ 0;

        // Custom Chart Defaults
        Chart.defaults.color = "#9ca3af";
        Chart.defaults.font.family = "Outfit";

        const ctxHabitaciones = document
          .getElementById("habitacionesChart")
          .getContext("2d");
        new Chart(ctxHabitaciones, {
          type: "doughnut",
          data: {
            labels: ["Ocupadas", "Mantenimiento", "Disponibles"],
            datasets: [
              {
                data: [ocupadas, mantenimiento, disponibles],
                backgroundColor: [
                  "#046307",
                  "#D4AF37",
                  "rgba(255,255,255,0.1)",
                ],
                borderWidth: 0,
                hoverOffset: 10,
                borderRadius: 5,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: "85%",
            plugins: { legend: { display: false } },
            animation: { animateScale: true, animateRotate: true },
          },
        });

        const ingresosData = /*[[${ingresosUltimos30Dias}]]*/ [];
        const labels = ingresosData.map((d) => {
          const date = new Date(d.fecha);
          return date.toLocaleDateString("es-ES", {
            day: "numeric",
            month: "short",
          });
        });
        const data = ingresosData.map((d) => d.ingresos);

        const ctxIngresos = document
          .getElementById("ingresosChart")
          .getContext("2d");
        const gradient = ctxIngresos.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, "rgba(4, 99, 7, 0.5)");
        gradient.addColorStop(1, "rgba(4, 99, 7, 0.0)");

        new Chart(ctxIngresos, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Ingresos",
                data: data,
                borderColor: "#046307",
                backgroundColor: gradient,
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointRadius: 0,
                pointHoverRadius: 6,
                pointHoverBackgroundColor: "#D4AF37",
                pointHoverBorderColor: "#fff",
                pointHoverBorderWidth: 2,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: "rgba(0,0,0,0.8)",
                titleColor: "#fff",
                bodyColor: "#fff",
                padding: 10,
                cornerRadius: 8,
                displayColors: false,
              },
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { maxTicksLimit: 8, color: "rgba(255,255,255,0.4)" },
              },
              y: {
                beginAtZero: true,
                grid: { color: "rgba(255,255,255,0.05)" },
                ticks: { color: "rgba(255,255,255,0.4)" },
              },
            },
            interaction: { mode: "nearest", axis: "x", intersect: false },
          },
        });
      });
    </script>
  </body>
</html>
