<!DOCTYPE html>
<html class="dark" lang="es" xmlns:th="http://www.thymeleaf.org">
  <head th:replace="fragments/common :: head"></head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-gray-900 dark:text-gray-100 overflow-hidden"
  >
    <div class="flex h-screen w-full overflow-hidden">
      <!-- SideNavBar -->
      <aside th:replace="fragments/common :: sidebar"></aside>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col min-w-0 overflow-hidden relative">
        <!-- Background Elements -->
        <div
          class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none"
        >
          <div
            class="absolute top-[-10%] right-[-5%] w-[500px] h-[500px] rounded-full bg-primary/5 blur-[100px]"
          ></div>
          <div
            class="absolute bottom-[-10%] left-[-5%] w-[500px] h-[500px] rounded-full bg-accent/5 blur-[100px]"
          ></div>
        </div>

        <!-- Top Header -->
        <header th:replace="fragments/common :: navbar"></header>

        <main class="flex-1 flex flex-col p-8 overflow-hidden">
          <div class="flex flex-col h-full w-full max-w-7xl mx-auto gap-6">
            <!-- PageHeading & ToolBar -->
            <header class="flex flex-wrap justify-between items-start gap-4">
              <div class="flex flex-col gap-1">
                <h1 class="text-white text-3xl font-bold tracking-tight">
                  Monitoreo del Sistema
                </h1>
                <div class="flex items-center gap-2">
                  <div class="relative flex h-2.5 w-2.5">
                    <span
                      class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"
                    ></span>
                    <span
                      class="relative inline-flex rounded-full h-2.5 w-2.5 bg-primary"
                    ></span>
                  </div>
                  <p
                    class="text-primary text-sm font-bold uppercase tracking-wider"
                  >
                    Conectado
                  </p>
                </div>
              </div>
              <div class="flex gap-2 items-center">
                <button
                  aria-label="Pausar monitoreo en vivo"
                  class="p-2.5 rounded-xl bg-white/5 border border-white/5 text-white/60 hover:text-white hover:bg-white/10 transition-colors"
                >
                  <span class="material-symbols-outlined">pause_circle</span>
                </button>
                <button
                  aria-label="Reanudar monitoreo"
                  class="p-2.5 rounded-xl bg-white/5 border border-white/5 text-white/60 hover:text-primary hover:bg-white/10 transition-colors"
                >
                  <span class="material-symbols-outlined">play_circle</span>
                </button>
              </div>
            </header>

            <!-- Filter & Search Bar -->
            <div
              class="glass-panel rounded-2xl p-4 border border-white/10 shadow-xl"
            >
              <form
                th:action="@{/monitoreo}"
                method="get"
                class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"
              >
                <!-- SearchBar -->
                <div class="lg:col-span-2">
                  <div class="relative group">
                    <span
                      class="absolute inset-y-0 left-0 flex items-center pl-3 text-white/40 group-focus-within:text-primary transition-colors"
                    >
                      <span class="material-symbols-outlined">search</span>
                    </span>
                    <input
                      name="query"
                      class="w-full pl-10 pr-4 py-2.5 rounded-xl bg-black/20 border border-white/10 text-white placeholder:text-white/20 focus:ring-2 focus:ring-primary/50 focus:border-primary/50 focus:bg-black/40 transition-all duration-300"
                      placeholder="Buscar en logs..."
                      th:value="${query}"
                    />
                  </div>
                </div>
                <!-- Level Filter Dropdown -->
                <div>
                  <div class="relative">
                    <select
                      name="nivel"
                      onchange="this.form.submit()"
                      class="w-full rounded-xl bg-black/20 border border-white/10 text-white focus:ring-2 focus:ring-primary/50 focus:border-primary/50 focus:bg-black/40 transition-all duration-300 py-2.5 pl-3 pr-8 [&>option]:bg-[#121212]"
                    >
                      <option
                        value=""
                        th:selected="${nivel == null || nivel == ''}"
                      >
                        Todos los niveles
                      </option>
                      <option value="Info" th:selected="${nivel == 'Info'}">
                        Info (Creación)
                      </option>
                      <option
                        value="Advertencia"
                        th:selected="${nivel == 'Advertencia'}"
                      >
                        Advertencia (Actualización)
                      </option>
                      <option value="Error" th:selected="${nivel == 'Error'}">
                        Error
                      </option>
                      <option
                        value="Crítico"
                        th:selected="${nivel == 'Crítico'}"
                      >
                        Crítico (Eliminación)
                      </option>
                    </select>
                  </div>
                </div>
                <!-- Date Range Selector -->
                <div>
                  <div class="relative">
                    <input
                      name="fecha"
                      onchange="this.form.submit()"
                      th:value="${fecha}"
                      class="w-full rounded-xl bg-black/20 border border-white/10 text-white focus:ring-2 focus:ring-primary/50 focus:border-primary/50 focus:bg-black/40 transition-all duration-300 py-2.5 px-3"
                      type="date"
                    />
                  </div>
                </div>
                <button type="submit" class="hidden">Buscar</button>
              </form>

              <!-- Chips & Clear Button -->
              <div
                class="flex justify-between items-center gap-4 mt-4 pt-4 border-t border-white/5"
              >
                <div class="flex gap-2 overflow-x-auto custom-scrollbar pb-1">
                  <a
                    th:href="@{/monitoreo}"
                    class="flex items-center justify-center px-4 py-1.5 rounded-full text-xs font-bold transition-all duration-200 border"
                    th:classappend="${nivel == null || nivel == ''} ? 'bg-primary/20 text-primary border-primary/20' : 'bg-white/5 border-white/10 text-white/60 hover:bg-white/10 hover:text-white'"
                  >
                    Todos
                  </a>
                  <a
                    th:href="@{/monitoreo(nivel='Info')}"
                    class="flex items-center justify-center px-4 py-1.5 rounded-full text-xs font-bold transition-all duration-200 border"
                    th:classappend="${nivel == 'Info'} ? 'bg-blue-500/20 text-blue-400 border-blue-500/20' : 'bg-white/5 border-white/10 text-white/60 hover:bg-blue-500/10 hover:text-blue-400'"
                  >
                    Info
                  </a>
                  <a
                    th:href="@{/monitoreo(nivel='Advertencia')}"
                    class="flex items-center justify-center px-4 py-1.5 rounded-full text-xs font-bold transition-all duration-200 border"
                    th:classappend="${nivel == 'Advertencia'} ? 'bg-accent/20 text-accent border-accent/20' : 'bg-white/5 border-white/10 text-white/60 hover:bg-accent/10 hover:text-accent'"
                  >
                    Advertencia
                  </a>
                  <a
                    th:href="@{/monitoreo(nivel='Error')}"
                    class="flex items-center justify-center px-4 py-1.5 rounded-full text-xs font-bold transition-all duration-200 border"
                    th:classappend="${nivel == 'Error'} ? 'bg-red-500/20 text-red-400 border-red-500/20' : 'bg-white/5 border-white/10 text-white/60 hover:bg-red-500/10 hover:text-red-400'"
                  >
                    Error
                  </a>
                </div>
                <a
                  th:href="@{/monitoreo}"
                  class="flex items-center gap-1.5 text-white/40 hover:text-white transition-colors text-xs font-bold uppercase tracking-wider"
                >
                  <span class="material-symbols-outlined text-base">close</span>
                  Limpiar
                </a>
              </div>
            </div>

            <!-- Log Panel -->
            <div
              class="flex-1 glass-panel rounded-2xl border border-white/10 shadow-xl overflow-hidden flex flex-col"
            >
              <div
                class="bg-black/40 p-3 border-b border-white/10 flex items-center justify-between"
              >
                <span class="text-xs font-mono text-white/40 uppercase"
                  >System Logs Output</span
                >
                <div class="flex gap-1.5">
                  <div
                    class="size-2.5 rounded-full bg-red-500/20 border border-red-500/50"
                  ></div>
                  <div
                    class="size-2.5 rounded-full bg-yellow-500/20 border border-yellow-500/50"
                  ></div>
                  <div
                    class="size-2.5 rounded-full bg-green-500/20 border border-green-500/50"
                  ></div>
                </div>
              </div>
              <div
                class="flex-1 overflow-y-auto p-4 font-mono text-xs md:text-sm custom-scrollbar bg-black/20"
              >
                <div class="flex flex-col gap-1">
                  <div
                    th:each="log : ${logs}"
                    class="flex items-start gap-3 p-2 rounded hover:bg-white/5 transition-colors border-l-2 border-transparent"
                    th:classappend="${#strings.contains(log.tipoAccion, 'ERROR') or #strings.contains(log.tipoAccion, 'ELIMINACION')} ? 'text-red-300 border-red-500/50 bg-red-500/5' : 
                         (${#strings.contains(log.tipoAccion, 'CANCELACION')} ? 'text-red-300 border-red-500/50 bg-red-500/5 font-bold' : 
                         (${#strings.contains(log.tipoAccion, 'ADVERTENCIA')} ? 'text-yellow-300 border-yellow-500/50 bg-yellow-500/5' : 'text-white/70 border-white/10'))"
                  >
                    <span
                      class="text-white/30 whitespace-nowrap"
                      th:text="${#temporals.format(log.timestamp, 'yyyy-MM-dd HH:mm:ss')}"
                      >2023-10-27 10:00:01</span
                    >
                    <span
                      class="font-bold whitespace-nowrap"
                      th:classappend="${#strings.contains(log.tipoAccion, 'CREACION') or #strings.contains(log.tipoAccion, 'REGISTRO')} ? 'text-primary' : 
                          (${#strings.contains(log.tipoAccion, 'ACTUALIZACION') or #strings.contains(log.tipoAccion, 'MODIFICACION')} ? 'text-accent' : 
                          'text-blue-400')"
                      th:text="'[' + ${log.tipoAccion} + ']'"
                      >[INFO]</span
                    >
                    <p class="flex-1 break-all" th:text="${log.detalleAccion}">
                      Servicio de autenticación iniciado correctamente.
                    </p>
                  </div>

                  <div
                    th:if="${#lists.isEmpty(logs)}"
                    class="text-center py-10 text-white/20 italic"
                  >
                    No hay logs para mostrar con los filtros actuales.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </body>
</html>
