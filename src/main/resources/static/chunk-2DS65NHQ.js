import{a as T,b as se}from"./chunk-CPPCMVDG.js";import{a as U}from"./chunk-6AL5JYWX.js";import{a as pe}from"./chunk-YPPC7AQK.js";import{a as ce}from"./chunk-YG3CPSL3.js";import{a as de}from"./chunk-IOAMSEWY.js";import"./chunk-HAICC4VJ.js";import{b as X,c as Y,d as $,e as ee,f as te,g as ie,j as ne,k as re,l as oe,n as ae,s as le}from"./chunk-SW222O52.js";import{$ as y,D as d,E as w,H as S,J as h,Ka as K,N as t,Na as Q,O as e,P as f,S as O,T as x,U as I,X as n,Y as R,Z as m,aa as _,ba as E,da as P,ea as V,fa as B,ga as L,ka as C,la as j,ma as F,q as M,sa as W,ta as z,u as A,ua as q,v as D,wa as G,xa as H,ya as Z,za as J}from"./chunk-DBIQ3VVQ.js";var he=()=>["/notificaciones"],fe=l=>({id:l}),ge=(l,u)=>({"bg-white/5":l,"opacity-70":u});function xe(l,u){l&1&&f(0,"span",66)}function be(l,u){if(l&1){let i=O();t(0,"div",76),x("click",function(){let r=A(i).$implicit,o=I(2);return o.markAsRead(r),D(o.toggleNotifications())}),t(1,"p",77),n(2),e(),t(3,"p",78),n(4),e(),t(5,"div",79)(6,"span",80),n(7),e(),t(8,"p",81),n(9),C(10,"date"),e()()()}if(l&2){let i=u.$implicit;h("routerLink",V(10,he))("queryParams",B(11,fe,i.id))("ngClass",L(13,ge,!i.leida,i.leida)),d(2),R(i.titulo),d(2),m(" ",i.mensaje," "),d(3),R(i.tipo),d(2),m(" ",F(10,7,i.fechaCreacion,"short")," ")}}function ve(l,u){l&1&&(t(0,"div",82)(1,"span",83),n(2,"notifications_off"),e(),n(3," No tienes notificaciones "),e())}function we(l,u){if(l&1&&(t(0,"div",67)(1,"div",68)(2,"h3",69),n(3,"Notificaciones"),e(),t(4,"span",70),n(5),e()(),t(6,"div",71),S(7,be,11,16,"div",72)(8,ve,4,0,"div",73),e(),t(9,"div",74)(10,"a",75),n(11," Ver todas "),e()()()),l&2){let i=I();d(5),m("",i.unreadCount," nuevas"),d(2),h("ngForOf",i.notifications),d(),h("ngIf",i.notifications.length===0)}}T.register(...se);var Ae=(()=>{class l{constructor(i,a,r){this.reservaService=i,this.habitacionService=a,this.dashboardService=r,this.fechaInicio="",this.fechaFin="",this.tipo="financiero",this.ingresosTotales=0,this.tasaOcupacion="0.0",this.adr="0.00",this.showNotifications=!1,this.notifications=[],this.unreadCount=0}ngOnInit(){let i=new Date;this.fechaFin=i.toISOString().split("T")[0];let a=new Date;a.setDate(i.getDate()-30),this.fechaInicio=a.toISOString().split("T")[0],this.generarReporte(),this.loadNotifications()}loadNotifications(){this.dashboardService.getNotifications().subscribe({next:i=>{this.notifications=i||[],this.unreadCount=this.notifications.filter(a=>!a.leida).length},error:i=>console.error("Error loading notifications",i)})}toggleNotifications(){this.showNotifications=!this.showNotifications}markAsRead(i){i.leida||this.dashboardService.markAsRead(i.id).subscribe(()=>{i.leida=!0,this.unreadCount=Math.max(0,this.unreadCount-1)})}generarReporte(){this.reservaService.getAll().subscribe(i=>{let a=new Date(this.fechaInicio),r=new Date(this.fechaFin),o=i.filter(p=>{let c=new Date(p.fechaInicio);return c>=a&&c<=r});this.ingresosTotales=o.filter(p=>p.estadoReserva==="FINALIZADA"||p.estadoReserva==="ACTIVA").reduce((p,c)=>{let v=0;c.servicios&&Array.isArray(c.servicios)&&(v=c.servicios.reduce((me,ue)=>{let N=ue.split(" - S/.");return me+(N.length===2?parseFloat(N[1]):0)},0));let k=(c.habitacionPrecio||0)*(c.diasEstadia||1),g=Math.max(0,k+v-(c.montoDescuento||0));return p+g},0);let s=o.filter(p=>p.estadoReserva==="FINALIZADA").length,b=s>0?this.ingresosTotales/s:0;this.adr=b.toFixed(2),this.habitacionService.getAll().subscribe(p=>{let c=p.length,v=new Set(o.filter(g=>g.estadoReserva==="ACTIVA").map(g=>g.habitacionNumero)).size,k=c>0?v/c*100:0;this.tasaOcupacion=k.toFixed(1)})}),this.tipo==="financiero"?this.reservaService.getIngresosReport(this.fechaInicio,this.fechaFin).subscribe({next:i=>{let a=i.map(o=>o.periodo||o.fecha),r=i.map(o=>o.ingresos||o.ingreso||o.total||0);this.renderChart(a,r,"line","Ingresos (S/.)")},error:i=>console.error("Error fetching chart data",i)}):this.tipo==="ocupacion"?this.reservaService.getOcupacionReport(this.fechaInicio,this.fechaFin).subscribe({next:i=>{let a=i.map(o=>o.fecha),r=i.map(o=>o.ocupacion||o.ocupadas||o.cantidad||0);this.renderChart(a,r,"bar","Habitaciones Ocupadas")},error:i=>console.error("Error fetching chart data",i)}):this.tipo==="rendimiento"&&this.reservaService.getOcupacionReport(this.fechaInicio,this.fechaFin).subscribe({next:i=>{let a=i.map(o=>o.fecha),r=i.map(o=>o.ocupacion||o.ocupadas||o.cantidad||0);this.renderChart(a,r,"line","Tendencia de Rendimiento",!0)},error:i=>console.error("Error fetching chart data",i)})}renderChart(i,a,r,o,s=!1){this.chart&&this.chart.destroy();let b=document.getElementById("mainChart");if(!b)return;(!i||i.length===0)&&(i=["Sin datos"],a=[0]);let p="#10B981",c="#10B98140";s&&(p="#8B5CF6",c="rgba(139, 92, 246, 0.4)"),this.chart=new T(b,{type:r,data:{labels:i,datasets:[{label:o,data:a,borderColor:p,backgroundColor:c,fill:s||r==="bar",tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"white"}}},scales:{x:{ticks:{color:"white"},grid:{color:"rgba(255,255,255,0.1)"}},y:{ticks:{color:"white"},grid:{color:"rgba(255,255,255,0.1)"}}}}})}exportarPDF(){this.reservaService.getReporteHtml(this.fechaInicio,this.fechaFin).subscribe({next:i=>{let a=window.open("","_blank");a?(a.document.open(),a.document.write(i),a.document.close()):alert("Por favor permite ventanas emergentes para ver el reporte.")},error:i=>{console.error("Error generando reporte",i),alert("Error al generar el reporte. Verifique su sesi\xF3n.")}})}static{this.\u0275fac=function(a){return new(a||l)(w(ce),w(pe),w(U))}}static{this.\u0275cmp=M({type:l,selectors:[["app-reportes"]],standalone:!0,features:[P],decls:141,vars:14,consts:[[1,"flex","h-screen","bg-background-dark","overflow-hidden"],[1,"hidden","md:block"],[1,"flex-1","flex","flex-col","min-w-0","overflow-hidden","relative"],[1,"absolute","top-0","left-0","w-full","h-full","overflow-hidden","-z-10","pointer-events-none"],[1,"absolute","top-[-10%]","right-[-5%]","w-[500px]","h-[500px]","rounded-full","bg-primary/5","blur-[100px]"],[1,"absolute","bottom-[-10%]","left-[-5%]","w-[500px]","h-[500px]","rounded-full","bg-accent/5","blur-[100px]"],[1,"h-16","border-b","border-white/5","bg-background-dark/50","backdrop-blur-xl","flex","items-center","justify-between","px-8","z-20","sticky","top-0"],[1,"flex","flex-col","justify-center"],[1,"text-xl","font-bold","text-white","tracking-tight"],[1,"flex","items-center","gap-2","text-xs","text-white/50"],["routerLink","/dashboard",1,"hover:text-primary","transition-colors"],[1,"material-symbols-outlined","text-[10px]"],[1,"text-white"],[1,"flex","items-center","gap-4"],[1,"relative","group","hidden","md:block"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","text-white/40","group-focus-within:text-primary","transition-colors"],[1,"material-symbols-outlined","text-lg"],["type","text","placeholder","Buscar reporte...",1,"w-64","pl-9","pr-4","py-2","rounded-full","bg-black/20","border","border-white/10","text-sm","text-white","placeholder-white/30","focus:ring-1","focus:ring-primary/50","focus:border-primary/50","focus:bg-black/40","transition-all"],[1,"relative"],["type","button",1,"relative","p-2","text-white/60","hover:text-white","transition-colors","rounded-full","hover:bg-white/5","cursor-pointer","z-50",3,"click"],[1,"material-symbols-outlined","pointer-events-none"],["class","absolute top-2 right-2 w-2 h-2 bg-accent rounded-full border-2 border-[#121212] pointer-events-none",4,"ngIf"],["class","absolute right-0 top-full mt-2 w-80 bg-[#1e1e1e] border border-white/10 rounded-lg shadow-xl overflow-hidden z-[100]",4,"ngIf"],[1,"flex-1","p-8","overflow-y-auto","scroll-smooth"],[1,"flex","flex-col","gap-8","max-w-7xl","mx-auto"],[1,"flex","flex-wrap","justify-between","items-center","gap-4"],[1,"flex","flex-col","gap-1"],[1,"text-white","text-3xl","font-bold","tracking-tight"],[1,"text-white/60","text-base","font-medium"],[1,"flex","items-center","gap-2","px-5","py-2.5","rounded-lg","bg-primary","text-white","font-bold","hover:bg-primary/90","transition-all","duration-200","shadow-lg","shadow-primary/20","hover:scale-105","cursor-pointer",3,"click"],[1,"material-symbols-outlined"],[1,"truncate"],[1,"grid","grid-cols-12","gap-8","items-start"],[1,"col-span-12","lg:col-span-4","flex","flex-col","gap-6"],[1,"glass-panel","rounded-2xl","p-6","border","border-white/10","shadow-xl"],[1,"flex","flex-col","gap-6",3,"ngSubmit"],[1,"text-lg","font-bold","text-white","flex","items-center","gap-2"],[1,"p-2","rounded-lg","bg-primary/10","text-primary"],[1,"space-y-1.5"],[1,"text-xs","font-bold","text-white/60","uppercase","tracking-wider","ml-1"],["name","tipo",1,"w-full","rounded-lg","bg-black/20","border","border-white/10","text-white","focus:ring-2","focus:ring-primary/50","focus:border-primary/50","focus:bg-black/40","transition-all","duration-300","p-3",3,"ngModelChange","ngModel"],["value","financiero"],["value","ocupacion"],["value","rendimiento"],[1,"flex","flex-col","gap-3"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","text-white/40","pointer-events-none"],["name","fechaInicio","type","date","required","",1,"w-full","pl-10","rounded-lg","bg-black/20","border","border-white/10","text-white","focus:ring-2","focus:ring-primary/50","focus:border-primary/50","focus:bg-black/40","transition-all","duration-300",3,"ngModelChange","ngModel"],["name","fechaFin","type","date","required","",1,"w-full","pl-10","rounded-lg","bg-black/20","border","border-white/10","text-white","focus:ring-2","focus:ring-primary/50","focus:border-primary/50","focus:bg-black/40","transition-all","duration-300",3,"ngModelChange","ngModel"],["type","submit",1,"w-full","px-6","py-3","rounded-lg","bg-white/10","text-white","font-bold","hover:bg-white/20","transition-all","duration-200","border","border-white/10","hover:border-white/20"],[1,"col-span-12","lg:col-span-8","flex","flex-col","gap-6"],[1,"grid","grid-cols-1","sm:grid-cols-2","xl:grid-cols-3","gap-6"],[1,"glass-panel","rounded-2xl","p-5","border","border-white/10","shadow-lg","relative","overflow-hidden","group"],[1,"absolute","top-0","right-0","p-4","opacity-10","group-hover:opacity-20","transition-opacity"],[1,"material-symbols-outlined","text-6xl","text-white"],[1,"text-sm","font-medium","text-white/60","uppercase","tracking-wider"],[1,"text-3xl","font-bold","text-white","mt-2"],[1,"mt-4","flex","items-center","gap-2"],[1,"px-2","py-1","rounded-md","bg-green-500/10","text-green-400","text-xs","font-bold","flex","items-center","gap-1"],[1,"material-symbols-outlined","text-sm"],[1,"text-xs","text-white/40"],[1,"px-2","py-1","rounded-md","bg-red-500/10","text-red-400","text-xs","font-bold","flex","items-center","gap-1"],[1,"flex","items-center","justify-between","mb-6"],[1,"text-white","text-lg","font-bold","flex","items-center","gap-2"],[1,"p-2","rounded-lg","hover:bg-white/10","text-white/40","hover:text-white","transition-colors"],[1,"w-full","h-80","rounded-xl","p-2","relative"],["id","mainChart"],[1,"absolute","top-2","right-2","w-2","h-2","bg-accent","rounded-full","border-2","border-[#121212]","pointer-events-none"],[1,"absolute","right-0","top-full","mt-2","w-80","bg-[#1e1e1e]","border","border-white/10","rounded-lg","shadow-xl","overflow-hidden","z-[100]"],[1,"p-3","border-b","border-white/10","flex","justify-between","items-center","bg-white/5"],[1,"text-white","font-bold","text-sm"],[1,"text-xs","text-[#a0a0a0]"],[1,"max-h-80","overflow-y-auto"],["class","p-3 border-b border-white/5 hover:bg-white/5 cursor-pointer transition-colors",3,"routerLink","queryParams","ngClass","click",4,"ngFor","ngForOf"],["class","p-8 text-center text-[#a0a0a0] text-sm flex flex-col items-center",4,"ngIf"],[1,"p-2","border-t","border-white/10","bg-white/5"],["routerLink","/notificaciones",1,"block","w-full","py-2","text-center","text-xs","font-bold","text-primary","hover:bg-white/5","rounded","transition-colors","cursor-pointer"],[1,"p-3","border-b","border-white/5","hover:bg-white/5","cursor-pointer","transition-colors",3,"click","routerLink","queryParams","ngClass"],[1,"text-sm","text-white","font-medium"],[1,"text-xs","text-[#a0a0a0]","mt-1","line-clamp-2"],[1,"flex","justify-between","items-center","mt-2"],[1,"text-[10px]","px-1.5","py-0.5","rounded","bg-white/10","text-white/50"],[1,"text-[10px]","text-white/40"],[1,"p-8","text-center","text-[#a0a0a0]","text-sm","flex","flex-col","items-center"],[1,"material-symbols-outlined","text-3xl","mb-2","opacity-30"]],template:function(a,r){a&1&&(t(0,"div",0)(1,"div",1),f(2,"app-sidebar"),e(),t(3,"div",2)(4,"div",3),f(5,"div",4)(6,"div",5),e(),t(7,"header",6)(8,"div",7)(9,"h2",8),n(10," Reportes y An\xE1lisis "),e(),t(11,"div",9)(12,"a",10),n(13,"Inicio"),e(),t(14,"span",11),n(15,"chevron_right"),e(),t(16,"span",12),n(17,"Reportes"),e()()(),t(18,"div",13)(19,"div",14)(20,"span",15)(21,"span",16),n(22,"search"),e()(),f(23,"input",17),e(),t(24,"div",18)(25,"button",19),x("click",function(){return r.toggleNotifications()}),t(26,"span",20),n(27,"notifications"),e(),S(28,xe,1,0,"span",21),e(),S(29,we,12,3,"div",22),e()()(),t(30,"main",23)(31,"div",24)(32,"header",25)(33,"div",26)(34,"h1",27),n(35," Reportes Avanzados y An\xE1lisis "),e(),t(36,"p",28),n(37," Genere, visualice y exporte datos clave del rendimiento del hotel. "),e()(),t(38,"button",29),x("click",function(){return r.exportarPDF()}),t(39,"span",30),n(40,"download"),e(),t(41,"span",31),n(42,"Exportar PDF"),e()()(),t(43,"div",32)(44,"aside",33)(45,"div",34)(46,"form",35),x("ngSubmit",function(){return r.generarReporte()}),t(47,"h3",36)(48,"span",37)(49,"span",30),n(50,"filter_alt"),e()(),n(51," Filtros de Reporte "),e(),t(52,"div",38)(53,"label",39),n(54,"Tipo de Reporte"),e(),t(55,"div",18)(56,"select",40),E("ngModelChange",function(s){return _(r.tipo,s)||(r.tipo=s),s}),t(57,"option",41),n(58,"Financiero"),e(),t(59,"option",42),n(60,"Ocupaci\xF3n"),e(),t(61,"option",43),n(62,"Rendimiento"),e()()()(),t(63,"div",38)(64,"label",39),n(65,"Rango de Fechas"),e(),t(66,"div",44)(67,"div",18)(68,"span",45)(69,"span",16),n(70,"calendar_today"),e()(),t(71,"input",46),E("ngModelChange",function(s){return _(r.fechaInicio,s)||(r.fechaInicio=s),s}),e()(),t(72,"div",18)(73,"span",45)(74,"span",16),n(75,"event"),e()(),t(76,"input",47),E("ngModelChange",function(s){return _(r.fechaFin,s)||(r.fechaFin=s),s}),e()()()(),t(77,"button",48),n(78," Generar Reporte "),e()()()(),t(79,"section",49)(80,"div",50)(81,"div",51)(82,"div",52)(83,"span",53),n(84,"payments"),e()(),t(85,"p",54),n(86," Ingresos Totales "),e(),t(87,"p",55),n(88),C(89,"number"),e(),t(90,"div",56)(91,"span",57)(92,"span",58),n(93,"trending_up"),e(),n(94," +2.5% "),e(),t(95,"span",59),n(96,"vs mes anterior"),e()()(),t(97,"div",51)(98,"div",52)(99,"span",53),n(100,"bed"),e()(),t(101,"p",54),n(102," Tasa de Ocupaci\xF3n "),e(),t(103,"p",55),n(104),e(),t(105,"div",56)(106,"span",57)(107,"span",58),n(108,"trending_up"),e(),n(109," +5.1% "),e(),t(110,"span",59),n(111,"vs mes anterior"),e()()(),t(112,"div",51)(113,"div",52)(114,"span",53),n(115,"analytics"),e()(),t(116,"p",54),n(117," Tarifa Diaria Prom. (ADR) "),e(),t(118,"p",55),n(119),e(),t(120,"div",56)(121,"span",60)(122,"span",58),n(123,"trending_down"),e(),n(124," -1.2% "),e(),t(125,"span",59),n(126,"vs mes anterior"),e()()()(),t(127,"div",34)(128,"div",61)(129,"h4",62)(130,"span",37)(131,"span",30),n(132,"bar_chart"),e()(),t(133,"span"),n(134),C(135,"titlecase"),e()(),t(136,"button",63)(137,"span",30),n(138,"more_vert"),e()()(),t(139,"div",64),f(140,"canvas",65),e()()()()()()()()),a&2&&(d(28),h("ngIf",r.unreadCount>0),d(),h("ngIf",r.showNotifications),d(27),y("ngModel",r.tipo),d(15),y("ngModel",r.fechaInicio),d(5),y("ngModel",r.fechaFin),d(12),m(" $",F(89,9,r.ingresosTotales,"1.2-2")," "),d(16),m(" ",r.tasaOcupacion,"% "),d(15),m("$",r.adr,""),d(15),m("Reporte de ",j(135,12,r.tipo),""))},dependencies:[J,W,z,q,Z,G,H,le,ie,re,oe,X,ne,Y,$,ae,te,ee,de,Q,K]})}}return l})();export{Ae as ReportesComponent};
