import{a as G}from"./chunk-6AL5JYWX.js";import{a as oe}from"./chunk-IOAMSEWY.js";import"./chunk-HAICC4VJ.js";import{b as J,c as Q,d as X,e as Y,f as Z,g as $,j as ee,k as te,l as ie,s as ne}from"./chunk-SW222O52.js";import{$ as _,Aa as H,Ba as B,D as a,E as S,H as x,J as c,Ka as U,N as i,Na as q,O as t,Oa as K,P as v,S as C,T as p,U as g,V as F,X as n,Y as u,Z as f,_ as T,aa as y,ba as E,da as L,ea as P,fa as j,ga as O,k,ka as I,ma as A,n as N,q as M,sa as R,ta as V,u as b,ua as z,v as w,xa as D,za as W}from"./chunk-DBIQ3VVQ.js";var re=(()=>{class o{constructor(e){this.http=e,this.apiUrl=`${K.apiUrl}/auditoria`}getLogs(e,l,r,s,d){let h=new H().set("page",e.toString()).set("size",l.toString());return r&&(h=h.set("search",r)),s&&(h=h.set("tipoAccion",s)),d&&(h=h.set("fechaInicio",d)),this.http.get(this.apiUrl,{params:h})}static{this.\u0275fac=function(l){return new(l||o)(N(B))}}static{this.\u0275prov=k({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var de=()=>["/notificaciones"],se=o=>({id:o}),ce=(o,m)=>({"bg-white/5":o,"opacity-70":m});function me(o,m){o&1&&v(0,"span",50)}function pe(o,m){if(o&1){let e=C();i(0,"div",60),p("click",function(){let r=b(e).$implicit,s=g(2);return s.markAsRead(r),w(s.toggleNotifications())}),i(1,"p",61),n(2),t(),i(3,"p",62),n(4),t(),i(5,"div",63)(6,"span",64),n(7),t(),i(8,"p",65),n(9),I(10,"date"),t()()()}if(o&2){let e=m.$implicit;c("routerLink",P(10,de))("queryParams",j(11,se,e.id))("ngClass",O(13,ce,!e.leida,e.leida)),a(2),u(e.titulo),a(2),f(" ",e.mensaje," "),a(3),u(e.tipo),a(2),f(" ",A(10,7,e.fechaCreacion,"short")," ")}}function ue(o,m){o&1&&(i(0,"div",66)(1,"span",67),n(2,"notifications_off"),t(),n(3," No tienes notificaciones "),t())}function he(o,m){if(o&1&&(i(0,"div",51)(1,"div",52)(2,"h3",53),n(3,"Notificaciones"),t(),i(4,"span",54),n(5),t()(),i(6,"div",55),x(7,pe,11,16,"div",56)(8,ue,4,0,"div",57),t(),i(9,"div",58)(10,"a",59),n(11," Ver todas "),t()()()),o&2){let e=g();a(5),f("",e.unreadCount," nuevas"),a(2),c("ngForOf",e.notifications),a(),c("ngIf",e.notifications.length===0)}}function xe(o,m){if(o&1&&(i(0,"tr",68)(1,"td",69)(2,"div",70)(3,"span",71),n(4,"schedule"),t(),i(5,"span"),n(6),I(7,"date"),t()()(),i(8,"td",72)(9,"span",73),n(10),t()(),i(11,"td",72)(12,"span",74),n(13),t()(),i(14,"td",75),n(15),t(),i(16,"td",76),n(17),t()()),o&2){let e=m.$implicit;a(6),u(A(7,7,e.timestamp,"dd/MM/yyyy HH:mm:ss")),a(4),f(" ",e.usuarioUsername," "),a(3),u(e.tipoAccion),a(),F("title",e.detalleAccion),a(),f(" ",e.detalleAccion," "),a(2),T(" ",e.entidadAfectada," #",e.entidadAfectadaId," ")}}function ge(o,m){o&1&&(i(0,"tr")(1,"td",77)(2,"span",78),n(3,"history_toggle_off"),t(),i(4,"p"),n(5,"No se encontraron registros de auditor\xEDa."),t()()())}function fe(o,m){if(o&1){let e=C();i(0,"div",79)(1,"div",80),n(2," Mostrando "),i(3,"span",81),n(4),t(),n(5," a "),i(6,"span",81),n(7),t(),n(8," de "),i(9,"span",81),n(10),t(),n(11," registros "),t(),i(12,"div",82)(13,"button",83),p("click",function(){b(e);let r=g();return w(r.onPageChange(r.page-1))}),n(14," Anterior "),t(),i(15,"button",83),p("click",function(){b(e);let r=g();return w(r.onPageChange(r.page+1))}),n(16," Siguiente "),t()()()}if(o&2){let e=g();a(4),u(e.page*e.size+1),a(3),u((e.page+1)*e.size>e.totalElements?e.totalElements:(e.page+1)*e.size),a(3),u(e.totalElements),a(3),c("disabled",e.page===0),a(2),c("disabled",e.page>=e.totalPages-1)}}var Ne=(()=>{class o{constructor(e,l){this.auditoriaService=e,this.dashboardService=l,this.logs=[],this.search="",this.tipoAccion="",this.fechaInicio="",this.page=0,this.size=20,this.totalPages=0,this.totalElements=0,this.showNotifications=!1,this.notifications=[],this.unreadCount=0}ngOnInit(){this.loadLogs(),this.loadNotifications()}loadNotifications(){this.dashboardService.getNotifications().subscribe({next:e=>{this.notifications=e||[],this.unreadCount=this.notifications.filter(l=>!l.leida).length},error:e=>console.error("Error loading notifications",e)})}toggleNotifications(){this.showNotifications=!this.showNotifications}markAsRead(e){e.leida||this.dashboardService.markAsRead(e.id).subscribe(()=>{e.leida=!0,this.unreadCount=Math.max(0,this.unreadCount-1)})}loadLogs(){this.auditoriaService.getLogs(this.page,this.size,this.search,this.tipoAccion,this.fechaInicio).subscribe({next:e=>{this.logs=e.content,this.totalPages=e.totalPages,this.totalElements=e.totalElements},error:e=>console.error("Error fetching logs",e)})}onSearch(){this.page=0,this.loadLogs()}onPageChange(e){e>=0&&e<this.totalPages&&(this.page=e,this.loadLogs())}static{this.\u0275fac=function(l){return new(l||o)(S(re),S(G))}}static{this.\u0275cmp=M({type:o,selectors:[["app-auditoria"]],standalone:!0,features:[L],decls:89,vars:8,consts:[[1,"flex","h-screen","bg-background-dark","overflow-hidden"],[1,"hidden","md:block"],[1,"flex-1","flex","flex-col","min-w-0","overflow-hidden","relative"],[1,"h-16","border-b","border-white/5","bg-background-dark/50","backdrop-blur-xl","flex","items-center","justify-between","px-8","z-20","sticky","top-0"],[1,"flex","flex-col","justify-center"],[1,"text-xl","font-bold","text-white","tracking-tight"],[1,"flex","items-center","gap-2","text-xs","text-white/50"],["routerLink","/dashboard",1,"hover:text-primary","transition-colors"],[1,"material-symbols-outlined","text-[10px]"],[1,"text-white"],[1,"flex","items-center","gap-4"],[1,"relative","group","hidden","md:block"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-3","text-white/40","group-focus-within:text-primary","transition-colors"],[1,"material-symbols-outlined","text-lg"],["type","text","placeholder","Buscar...",1,"w-64","pl-9","pr-4","py-2","rounded-full","bg-black/20","border","border-white/10","text-sm","text-white","placeholder-white/30","focus:ring-1","focus:ring-primary/50","focus:border-primary/50","focus:bg-black/40","transition-all"],[1,"relative"],["type","button",1,"relative","p-2","text-white/60","hover:text-white","transition-colors","rounded-full","hover:bg-white/5","cursor-pointer","z-50",3,"click"],[1,"material-symbols-outlined","pointer-events-none"],["class","absolute top-2 right-2 w-2 h-2 bg-accent rounded-full border-2 border-[#121212] pointer-events-none",4,"ngIf"],["class","absolute right-0 top-full mt-2 w-80 bg-[#1e1e1e] border border-white/10 rounded-lg shadow-xl overflow-hidden z-[100]",4,"ngIf"],[1,"flex-1","overflow-y-auto","p-8","scroll-smooth"],[1,"max-w-7xl","mx-auto"],[1,"flex","justify-between","items-center","mb-10","animate-fade-in-down"],[1,"text-3xl","font-bold","text-white","tracking-tight"],[1,"text-white/60","text-base","font-medium","mt-1"],[1,"glass-panel","rounded-2xl","p-6","mb-8","border","border-white/10","shadow-xl"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4","items-end",3,"ngSubmit"],[1,"block","text-sm","font-medium","text-white/60","mb-2"],[1,"material-symbols-outlined","absolute","left-3","top-1/2","-translate-y-1/2","text-white/40"],["type","text","name","search","placeholder","Usuario, acci\xF3n...",1,"w-full","pl-10","pr-4","py-2.5","bg-black/20","border","border-white/10","rounded-xl","focus:border-primary","focus:ring-1","focus:ring-primary","outline-none","transition-all","text-white","placeholder-white/20",3,"ngModelChange","ngModel"],["name","tipoAccion",1,"w-full","px-4","py-2.5","bg-black/20","border","border-white/10","rounded-xl","focus:border-primary","outline-none","text-white","[&>option]:bg-[#121212]",3,"ngModelChange","change","ngModel"],["value",""],["value","CREACION_RESERVA"],["value","CANCELACION_RESERVA"],["value","CHECK_IN"],["value","CHECK_OUT"],["value","CREACION_CLIENTE"],["value","ELIMINACION_CLIENTE"],["type","date","name","fechaInicio",1,"w-full","px-4","py-2.5","bg-black/20","border","border-white/10","rounded-xl","focus:border-primary","outline-none","text-white",3,"ngModelChange","change","ngModel"],["type","submit",1,"w-full","py-2.5","bg-primary","hover:bg-primary/90","text-white","font-bold","rounded-xl","transition-all","shadow-lg","shadow-primary/20","flex","items-center","justify-center","gap-2"],[1,"material-symbols-outlined"],[1,"glass-panel","rounded-2xl","overflow-hidden","border","border-white/10","shadow-xl"],[1,"overflow-x-auto"],[1,"w-full"],[1,"border-b","border-white/10","bg-white/5"],[1,"px-6","py-4","text-left","text-xs","font-bold","text-white/40","uppercase","tracking-wider"],[1,"divide-y","divide-white/5"],["class","hover:bg-white/5 transition-colors group",4,"ngFor","ngForOf"],[4,"ngIf"],["class","px-6 py-4 border-t border-white/10 flex items-center justify-between",4,"ngIf"],[1,"absolute","top-2","right-2","w-2","h-2","bg-accent","rounded-full","border-2","border-[#121212]","pointer-events-none"],[1,"absolute","right-0","top-full","mt-2","w-80","bg-[#1e1e1e]","border","border-white/10","rounded-lg","shadow-xl","overflow-hidden","z-[100]"],[1,"p-3","border-b","border-white/10","flex","justify-between","items-center","bg-white/5"],[1,"text-white","font-bold","text-sm"],[1,"text-xs","text-[#a0a0a0]"],[1,"max-h-80","overflow-y-auto"],["class","p-3 border-b border-white/5 hover:bg-white/5 cursor-pointer transition-colors",3,"routerLink","queryParams","ngClass","click",4,"ngFor","ngForOf"],["class","p-8 text-center text-[#a0a0a0] text-sm flex flex-col items-center",4,"ngIf"],[1,"p-2","border-t","border-white/10","bg-white/5"],["routerLink","/notificaciones",1,"block","w-full","py-2","text-center","text-xs","font-bold","text-primary","hover:bg-white/5","rounded","transition-colors","cursor-pointer"],[1,"p-3","border-b","border-white/5","hover:bg-white/5","cursor-pointer","transition-colors",3,"click","routerLink","queryParams","ngClass"],[1,"text-sm","text-white","font-medium"],[1,"text-xs","text-[#a0a0a0]","mt-1","line-clamp-2"],[1,"flex","justify-between","items-center","mt-2"],[1,"text-[10px]","px-1.5","py-0.5","rounded","bg-white/10","text-white/50"],[1,"text-[10px]","text-white/40"],[1,"p-8","text-center","text-[#a0a0a0]","text-sm","flex","flex-col","items-center"],[1,"material-symbols-outlined","text-3xl","mb-2","opacity-30"],[1,"hover:bg-white/5","transition-colors","group"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-white/80"],[1,"flex","items-center","gap-2"],[1,"material-symbols-outlined","text-white/40","text-sm"],[1,"px-6","py-4","whitespace-nowrap"],[1,"px-3","py-1","rounded-full","text-xs","font-bold","bg-blue-500/10","text-blue-400","border","border-blue-500/20","group-hover:bg-blue-500/20","transition-colors"],[1,"text-sm","font-bold","text-white"],[1,"px-6","py-4","text-sm","text-white/60","max-w-md","truncate",3,"title"],[1,"px-6","py-4","whitespace-nowrap","text-sm","text-white/40"],["colspan","5",1,"px-6","py-12","text-center","text-white/40"],[1,"material-symbols-outlined","text-4xl","mb-2"],[1,"px-6","py-4","border-t","border-white/10","flex","items-center","justify-between"],[1,"text-sm","text-white/40"],[1,"font-bold","text-white"],[1,"flex","gap-2"],[1,"px-4","py-2","rounded-lg","bg-white/5","border","border-white/10","text-white/60","hover:bg-white/10","hover:text-white","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(l,r){l&1&&(i(0,"div",0)(1,"div",1),v(2,"app-sidebar"),t(),i(3,"div",2)(4,"header",3)(5,"div",4)(6,"h2",5),n(7," Logs de Auditor\xEDa "),t(),i(8,"div",6)(9,"a",7),n(10,"Inicio"),t(),i(11,"span",8),n(12,"chevron_right"),t(),i(13,"span",9),n(14,"Auditor\xEDa"),t()()(),i(15,"div",10)(16,"div",11)(17,"span",12)(18,"span",13),n(19,"search"),t()(),v(20,"input",14),t(),i(21,"div",15)(22,"button",16),p("click",function(){return r.toggleNotifications()}),i(23,"span",17),n(24,"notifications"),t(),x(25,me,1,0,"span",18),t(),x(26,he,12,3,"div",19),t()()(),i(27,"main",20)(28,"div",21)(29,"div",22)(30,"div")(31,"h1",23),n(32," Logs de Auditor\xEDa "),t(),i(33,"p",24),n(34," Historial completo de operaciones del sistema. "),t()()(),i(35,"div",25)(36,"form",26),p("ngSubmit",function(){return r.onSearch()}),i(37,"div")(38,"label",27),n(39,"Buscar"),t(),i(40,"div",15)(41,"span",28),n(42,"search"),t(),i(43,"input",29),E("ngModelChange",function(d){return y(r.search,d)||(r.search=d),d}),t()()(),i(44,"div")(45,"label",27),n(46,"Tipo de Acci\xF3n"),t(),i(47,"select",30),E("ngModelChange",function(d){return y(r.tipoAccion,d)||(r.tipoAccion=d),d}),p("change",function(){return r.onSearch()}),i(48,"option",31),n(49,"Todas"),t(),i(50,"option",32),n(51,"Creaci\xF3n Reserva"),t(),i(52,"option",33),n(53,"Cancelaci\xF3n Reserva"),t(),i(54,"option",34),n(55,"Check-In"),t(),i(56,"option",35),n(57,"Check-Out"),t(),i(58,"option",36),n(59,"Registro Cliente"),t(),i(60,"option",37),n(61,"Eliminaci\xF3n Cliente"),t()()(),i(62,"div")(63,"label",27),n(64,"Fecha Inicio"),t(),i(65,"input",38),E("ngModelChange",function(d){return y(r.fechaInicio,d)||(r.fechaInicio=d),d}),p("change",function(){return r.onSearch()}),t()(),i(66,"button",39)(67,"span",40),n(68,"filter_list"),t(),n(69," Filtrar Logs "),t()()(),i(70,"div",41)(71,"div",42)(72,"table",43)(73,"thead")(74,"tr",44)(75,"th",45),n(76," Fecha y Hora "),t(),i(77,"th",45),n(78," Usuario "),t(),i(79,"th",45),n(80," Acci\xF3n "),t(),i(81,"th",45),n(82," Detalle "),t(),i(83,"th",45),n(84," Entidad "),t()()(),i(85,"tbody",46),x(86,xe,18,10,"tr",47)(87,ge,6,0,"tr",48),t()()(),x(88,fe,17,5,"div",49),t()()()()()),l&2&&(a(25),c("ngIf",r.unreadCount>0),a(),c("ngIf",r.showNotifications),a(17),_("ngModel",r.search),a(4),_("ngModel",r.tipoAccion),a(18),_("ngModel",r.fechaInicio),a(21),c("ngForOf",r.logs),a(),c("ngIf",r.logs.length===0),a(),c("ngIf",r.totalPages>1))},dependencies:[W,R,V,z,D,ne,$,te,ie,J,ee,Q,X,Z,Y,oe,q,U]})}}return o})();export{Ne as AuditoriaComponent};
