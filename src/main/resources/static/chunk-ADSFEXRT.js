import{a as ne}from"./chunk-YPPC7AQK.js";import{a as re,b as ae}from"./chunk-HDTJ3KOH.js";import{a as ie}from"./chunk-YG3CPSL3.js";import{a as te}from"./chunk-IOAMSEWY.js";import{a as oe}from"./chunk-YHTGSJXL.js";import{a as Q}from"./chunk-HAICC4VJ.js";import{b as q,c as G,f as U,j as Y,k as K,l as X,q as Z,s as ee}from"./chunk-SW222O52.js";import{$ as b,D as l,E as w,H as v,Ha as O,J as s,Ja as J,Ka as z,N as i,Na as $,O as t,P as T,S as g,T as u,U as d,X as r,Y as I,Z as _,_ as R,aa as y,ba as C,da as N,ga as S,ia as F,ka as h,la as f,ma as E,q as D,sa as B,ta as P,u as m,ua as W,v as x,va as j,ya as L,za as H}from"./chunk-DBIQ3VVQ.js";var A=(o,p)=>({"text-primary":o,"text-white/30":p}),k=(o,p,e,a)=>({"border-primary":o,"bg-primary":p,"text-[#121212]":e,"border-white/30":a}),M=(o,p)=>({"bg-[#2A2A2A] text-white":o,"text-white/40":p});function de(o,p){o&1&&(i(0,"div",10),T(1,"app-sidebar"),t())}function pe(o,p){o&1&&(i(0,"div",14)(1,"a",15),r(2,"Inicio"),t(),i(3,"span",16),r(4,"chevron_right"),t(),i(5,"span"),r(6,"Nueva Reserva"),t()())}function me(o,p){o&1&&(i(0,"div",14)(1,"a",17),r(2,"Cat\xE1logo"),t(),i(3,"span",16),r(4,"chevron_right"),t(),i(5,"span"),r(6,"Reservar"),t()())}function xe(o,p){if(o&1&&(i(0,"header",11)(1,"div")(2,"h2",12),r(3," Nueva Reserva "),t(),v(4,pe,7,0,"div",13),h(5,"async"),h(6,"async"),v(7,me,7,0,"div",13),h(8,"async"),t(),T(9,"div"),t()),o&2){let e=d();l(4),s("ngIf",f(5,2,e.isAdmin$)||f(6,4,e.isRecepcionista$)),l(3),s("ngIf",f(8,6,e.isCliente$))}}function ue(o,p){if(o&1&&(i(0,"div",18)(1,"div",19)(2,"div",20),r(3," 1 "),t(),i(4,"span",21),r(5,"Datos"),t()(),T(6,"div",22),i(7,"div",19)(8,"div",20),r(9," 2 "),t(),i(10,"span",21),r(11,"Servicios"),t()(),T(12,"div",22),i(13,"div",19)(14,"div",20),r(15," 3 "),t(),i(16,"span",21),r(17,"Pago"),t()()()),o&2){let e=d();l(),s("ngClass",S(6,A,e.step>=1,e.step<1)),l(),s("ngClass",F(9,k,e.step>=1,e.step>1,e.step>1,e.step<1)),l(5),s("ngClass",S(14,A,e.step>=2,e.step<2)),l(),s("ngClass",F(17,k,e.step>=2,e.step>2,e.step>2,e.step<2)),l(5),s("ngClass",S(22,A,e.step>=3,e.step<3)),l(),s("ngClass",F(25,k,e.step>=3,e.step>3,e.step>3,e.step<3))}}function ve(o,p){if(o&1&&(i(0,"div",23)(1,"span",24),r(2,"error"),t(),r(3),t()),o&2){let e=d();l(3),_(" ",e.error," ")}}function he(o,p){if(o&1){let e=g();i(0,"div",57)(1,"div",58)(2,"div",59)(3,"span",60)(4,"span",24),r(5,"badge"),t()(),i(6,"input",61),C("ngModelChange",function(n){m(e);let c=d(2);return y(c.searchTermCliente,n)||(c.searchTermCliente=n),x(n)}),u("keyup.enter",function(){m(e);let n=d(2);return x(n.buscarCliente())}),t()(),i(7,"button",62),u("click",function(){m(e);let n=d(2);return x(n.buscarCliente())}),i(8,"span",24),r(9,"search"),t()()()()}if(o&2){let e=d(2);l(6),b("ngModel",e.searchTermCliente)}}function _e(o,p){if(o&1){let e=g();i(0,"button",68),u("click",function(){m(e);let n=d(3);return n.selectedCliente=null,x(n.reserva.clienteId=null)}),i(1,"span",24),r(2,"close"),t()()}}function fe(o,p){if(o&1&&(i(0,"div",63)(1,"div",64),r(2),t(),i(3,"div")(4,"p",65),r(5),t(),i(6,"p",66),r(7),t(),i(8,"p",66),r(9),t()(),v(10,_e,3,0,"button",67),h(11,"async"),t()),o&2){let e=d(2);l(2),_(" ",e.selectedCliente.nombres.charAt(0)," "),l(3),R(" ",e.selectedCliente.nombres," ",e.selectedCliente.apellidos," "),l(2),_(" DNI: ",e.selectedCliente.dni," "),l(2),_(" ",e.selectedCliente.email," "),l(),s("ngIf",!f(11,6,e.isCliente$))}}function ge(o,p){o&1&&(i(0,"div",69)(1,"span",70),r(2,"refresh"),t(),r(3," Cargando sus datos... "),t())}function be(o,p){o&1&&(i(0,"div",71)(1,"span",72),r(2,"person_add"),t(),i(3,"p",73),r(4," Busque un cliente por DNI"),T(5,"br"),r(6,"para continuar con la reserva "),t(),i(7,"a",74),r(8,"Registrar Nuevo Cliente"),t()())}function ye(o,p){o&1&&(i(0,"p",75)(1,"span",76),r(2,"refresh"),t(),r(3," Buscando disponibilidad... "),t())}function Ce(o,p){o&1&&(i(0,"div",77)(1,"span",78),r(2,"check_circle"),t()())}function we(o,p){o&1&&(i(0,"div",77)(1,"span",78),r(2,"check_circle"),t()())}function Se(o,p){o&1&&(i(0,"div",77)(1,"span",78),r(2,"check_circle"),t()())}function Ee(o,p){o&1&&(i(0,"div",77)(1,"span",78),r(2,"check_circle"),t()())}function Te(o,p){if(o&1&&(i(0,"option",88),r(1),h(2,"number"),t()),o&2){let e=p.$implicit;s("ngValue",e.id),l(),R(" Habitaci\xF3n ",e.numero," - S/. ",E(2,3,e.precioPorNoche,"1.2-2"),"/noche ")}}function Ie(o,p){o&1&&(i(0,"option",89),r(1," No hay habitaciones disponibles "),t())}function Re(o,p){if(o&1&&(i(0,"p",90)(1,"span",91),r(2,"check"),t(),r(3),h(4,"number"),t()),o&2){let e=d(3);l(3),R(" Habitaci\xF3n ",e.selectedHabitacion==null?null:e.selectedHabitacion.numero," seleccionada - Precio: S/. ",E(4,2,e.getSelectedRoomPrice(),"1.2-2")," ")}}function Fe(o,p){if(o&1){let e=g();i(0,"div",79)(1,"label",80),r(2),t(),i(3,"div",43)(4,"span",81)(5,"span",78),r(6,"domain"),t()(),i(7,"select",82),C("ngModelChange",function(n){m(e);let c=d(2);return y(c.reserva.habitacionId,n)||(c.reserva.habitacionId=n),x(n)}),u("change",function(){m(e);let n=d(2);return x(n.onRoomNumberSelect())}),i(8,"option",83),r(9," Seleccione una habitaci\xF3n espec\xEDfica... "),t(),v(10,Te,3,6,"option",84)(11,Ie,2,0,"option",85),t(),i(12,"div",86)(13,"span",24),r(14,"expand_more"),t()()(),v(15,Re,5,5,"p",87),t()}if(o&2){let e=d(2);l(2),_(" Seleccione Habitaci\xF3n ",e.selectedRoomType," "),l(5),b("ngModel",e.reserva.habitacionId),l(),s("ngValue",null),l(2),s("ngForOf",e.filteredRooms),l(),s("ngIf",e.filteredRooms.length===0),l(4),s("ngIf",e.reserva.habitacionId)}}function Ve(o,p){if(o&1){let e=g();i(0,"div",25)(1,"div",26)(2,"div",27)(3,"div",28)(4,"span",29),r(5,"person_search"),t(),i(6,"h3",30),r(7,"Datos del Cliente"),t()(),v(8,he,10,1,"div",31),h(9,"async"),v(10,fe,12,8,"div",32)(11,ge,4,0,"div",33),h(12,"async"),v(13,be,9,0,"div",34),h(14,"async"),t()(),i(15,"div",26)(16,"div",35)(17,"div",26)(18,"div",36)(19,"div",37)(20,"label",38),r(21,"Fecha de Llegada"),t(),i(22,"div",39)(23,"div",40)(24,"span",41),r(25,"calendar_today"),t()(),i(26,"input",42),C("ngModelChange",function(n){m(e);let c=d();return y(c.reserva.fechaInicio,n)||(c.reserva.fechaInicio=n),x(n)}),u("change",function(){m(e);let n=d();return x(n.checkAvailability())}),t()()(),i(27,"div",37)(28,"label",38),r(29,"Fecha de Salida"),t(),i(30,"div",39)(31,"div",40)(32,"span",41),r(33,"calendar_today"),t()(),i(34,"input",42),C("ngModelChange",function(n){m(e);let c=d();return y(c.reserva.fechaFin,n)||(c.reserva.fechaFin=n),x(n)}),u("change",function(){m(e);let n=d();return x(n.checkAvailability())}),t()()()(),i(35,"div",36)(36,"div",37)(37,"label",38),r(38,"Hora de Entrada"),t(),i(39,"div",43)(40,"div",40)(41,"span",44),r(42,"schedule"),t()(),i(43,"input",45),C("ngModelChange",function(n){m(e);let c=d();return y(c.reserva.horaEntrada,n)||(c.reserva.horaEntrada=n),x(n)}),t()(),i(44,"p",46),r(45,"Check-in: 14:00 hrs"),t()(),i(46,"div",37)(47,"label",38),r(48,"Hora de Salida"),t(),i(49,"div",43)(50,"div",40)(51,"span",44),r(52,"schedule"),t()(),i(53,"input",45),C("ngModelChange",function(n){m(e);let c=d();return y(c.reserva.horaSalida,n)||(c.reserva.horaSalida=n),x(n)}),t()(),i(54,"p",46),r(55," Check-out: 12:00 hrs "),t()()(),i(56,"div",47)(57,"label",38),r(58,"Tipo de Habitaci\xF3n"),t(),v(59,ye,4,0,"p",48),i(60,"div",49)(61,"div",50),u("click",function(){m(e);let n=d();return x(n.filterRoomsByType("Simple"))}),i(62,"span",51),r(63,"bed"),t(),i(64,"div")(65,"h4",52),r(66,"Simple"),t(),i(67,"p",53),r(68,"1 Persona"),t()(),v(69,Ce,3,0,"div",54),t(),i(70,"div",50),u("click",function(){m(e);let n=d();return x(n.filterRoomsByType("Doble"))}),i(71,"span",51),r(72,"king_bed"),t(),i(73,"div")(74,"h4",52),r(75,"Doble"),t(),i(76,"p",53),r(77,"2 Personas"),t()(),v(78,we,3,0,"div",54),t(),i(79,"div",50),u("click",function(){m(e);let n=d();return x(n.filterRoomsByType("Suite Junior"))}),i(80,"span",51),r(81,"chair"),t(),i(82,"div")(83,"h4",52),r(84," Suite Junior "),t(),i(85,"p",53),r(86,"S/. 120.00"),t()(),v(87,Se,3,0,"div",54),t(),i(88,"div",50),u("click",function(){m(e);let n=d();return x(n.filterRoomsByType("Suite Familiar"))}),i(89,"span",51),r(90,"diamond"),t(),i(91,"div")(92,"h4",52),r(93," Suite Familiar "),t(),i(94,"p",53),r(95,"S/. 150.00"),t()(),v(96,Ee,3,0,"div",54),t()(),v(97,Fe,16,6,"div",55),t(),i(98,"button",56),u("click",function(){m(e);let n=d();return x(n.goToStep2())}),i(99,"span",24),r(100,"check_circle"),t(),i(101,"span"),r(102,"Solicitar Reserva"),t()()()()()()}if(o&2){let e=d();l(8),s("ngIf",!f(9,19,e.isCliente$)),l(2),s("ngIf",e.selectedCliente),l(),s("ngIf",f(12,21,e.isCliente$)&&!e.selectedCliente),l(2),s("ngIf",!e.selectedCliente&&!f(14,23,e.isCliente$)),l(13),b("ngModel",e.reserva.fechaInicio),l(8),b("ngModel",e.reserva.fechaFin),l(9),b("ngModel",e.reserva.horaEntrada),l(10),b("ngModel",e.reserva.horaSalida),l(6),s("ngIf",e.loading),l(2),s("ngClass",e.selectedRoomType==="Simple"?"border-[#008f6d] bg-[#1A1A1A]":"border-transparent bg-[#121212]"),l(8),s("ngIf",e.selectedRoomType==="Simple"),l(),s("ngClass",e.selectedRoomType==="Doble"?"border-[#008f6d] bg-[#1A1A1A]":"border-transparent bg-[#121212]"),l(8),s("ngIf",e.selectedRoomType==="Doble"),l(),s("ngClass",e.selectedRoomType==="Suite Junior"?"border-[#008f6d] bg-[#1A1A1A]":"border-transparent bg-[#121212]"),l(8),s("ngIf",e.selectedRoomType==="Suite Junior"),l(),s("ngClass",e.selectedRoomType==="Suite Familiar"?"border-[#008f6d] bg-[#1A1A1A]":"border-transparent bg-[#121212]"),l(8),s("ngIf",e.selectedRoomType==="Suite Familiar"),l(),s("ngIf",e.selectedRoomType),l(),s("disabled",!e.selectedCliente||!e.reserva.habitacionId||e.loading)}}function Ae(o,p){if(o&1){let e=g();i(0,"div",99)(1,"div")(2,"h4",100),r(3),t(),i(4,"p",101),r(5),t(),i(6,"p",102),r(7),t()(),i(8,"div",103)(9,"button",104),u("click",function(){let n=m(e).$implicit,c=d(2);return x(c.updateServiceQuantity(n,-1))}),i(10,"span",105),r(11,"remove"),t()(),i(12,"span",106),r(13),t(),i(14,"button",104),u("click",function(){let n=m(e).$implicit,c=d(2);return x(c.updateServiceQuantity(n,1))}),i(15,"span",105),r(16,"add"),t()()()()}if(o&2){let e=p.$implicit,a=d(2);l(3),I(e.nombre),l(2),I(e.descripcion),l(2),_("S/. ",e.precio,""),l(6),I(a.getQuantity(e.id))}}function ke(o,p){if(o&1){let e=g();i(0,"div",92)(1,"h3",93),r(2," Selecci\xF3n de Servicios Adicionales "),t(),i(3,"div",94),v(4,Ae,17,4,"div",95),t(),i(5,"div",96)(6,"button",97),u("click",function(){m(e);let n=d();return x(n.step=1)}),r(7," Atr\xE1s "),t(),i(8,"button",98),u("click",function(){m(e);let n=d();return x(n.goToStep3())}),r(9," Confirmar Servicios y Pagar "),t()()()}if(o&2){let e=d();l(4),s("ngForOf",e.servicios)}}function Me(o,p){if(o&1&&(i(0,"div",130)(1,"span"),r(2,"Descuento"),t(),i(3,"span"),r(4),h(5,"number"),t()()),o&2){let e=d(2);l(4),_("- S/. ",E(5,1,e.discountAmount,"1.2-2"),"")}}function De(o,p){if(o&1&&(i(0,"p",131)(1,"span",132),r(2,"check_circle"),t(),r(3),t()),o&2){let e=d(2);l(3),_(" Cup\xF3n aplicado: ",e.activeDiscount.descripcion," ")}}function Ne(o,p){o&1&&(i(0,"p",133),r(1," Cup\xF3n no v\xE1lido o expirado "),t())}function Be(o,p){if(o&1){let e=g();i(0,"div",134)(1,"div",135)(2,"label",136),r(3,"N\xFAmero de Tarjeta"),t(),i(4,"input",137),u("input",function(n){m(e);let c=d(2);return x(c.formatCardNumber(n))}),t()(),i(5,"div",138)(6,"div",139)(7,"label",136),r(8,"Expira"),t(),i(9,"input",140),u("input",function(n){m(e);let c=d(2);return x(c.formatExpiry(n))}),t()(),i(10,"div",141)(11,"label",136),r(12,"CVV"),t(),i(13,"input",142),u("input",function(n){m(e);let c=d(2);return x(c.formatCVV(n))}),t()()(),i(14,"div",135)(15,"label",136),r(16,"Titular"),t(),i(17,"input",143),C("ngModelChange",function(n){m(e);let c=d(2);return y(c.paymentData.holderName,n)||(c.paymentData.holderName=n),x(n)}),t()()()}if(o&2){let e=d(2);l(4),s("ngModel",e.paymentData.cardNumber),l(5),s("ngModel",e.paymentData.expiry),l(4),s("ngModel",e.paymentData.cvv),l(4),b("ngModel",e.paymentData.holderName)}}function Pe(o,p){if(o&1){let e=g();i(0,"div",144)(1,"p",66),r(2," Escanea el QR o env\xEDa al n\xFAmero: "),t(),i(3,"p",145),r(4,"934866021"),t(),i(5,"div",146)(6,"label",136),r(7,"N\xFAmero de Operaci\xF3n / Tel\xE9fono"),t(),i(8,"input",147),C("ngModelChange",function(n){m(e);let c=d(2);return y(c.paymentData.walletPhone,n)||(c.paymentData.walletPhone=n),x(n)}),t()()()}if(o&2){let e=d(2);l(8),b("ngModel",e.paymentData.walletPhone)}}function We(o,p){o&1&&(i(0,"span",148),r(1,"progress_activity"),t())}function je(o,p){o&1&&(i(0,"span"),r(1,"Confirmar y Pagar"),t())}function Le(o,p){o&1&&(i(0,"span",24),r(1,"check_circle"),t())}function He(o,p){if(o&1){let e=g();i(0,"div",92)(1,"div",107)(2,"div",108)(3,"h3",109),r(4," Resumen de Cuenta "),t(),i(5,"div",110)(6,"div",96)(7,"span"),r(8),t(),i(9,"span"),r(10),h(11,"number"),t()(),i(12,"div",96)(13,"span"),r(14,"Servicios Adicionales"),t(),i(15,"span"),r(16),h(17,"number"),t()(),v(18,Me,6,4,"div",111),i(19,"div",112)(20,"label",113),r(21,"Cup\xF3n de Descuento"),t(),i(22,"div",58)(23,"input",114),C("ngModelChange",function(n){m(e);let c=d();return y(c.promoCode,n)||(c.promoCode=n),x(n)}),t(),i(24,"button",115),u("click",function(){m(e);let n=d();return x(n.calculateDiscount())}),r(25," Aplicar "),t()(),v(26,De,4,1,"p",116)(27,Ne,2,0,"p",117),t()(),i(28,"div",118)(29,"span"),r(30,"Total a Pagar"),t(),i(31,"span",119),r(32),h(33,"number"),t()()(),i(34,"div",27)(35,"h3",120),r(36,"M\xE9todo de Pago"),t(),i(37,"div",121)(38,"button",122),u("click",function(){m(e);let n=d();return x(n.paymentMethod="TARJETA")}),r(39," Tarjeta "),t(),i(40,"button",122),u("click",function(){m(e);let n=d();return x(n.paymentMethod="EFECTIVO")}),r(41," Efectivo "),t(),i(42,"button",122),u("click",function(){m(e);let n=d();return x(n.paymentMethod="WALLET")}),r(43," Wallet (Yape/Plin) "),t()(),v(44,Be,18,4,"div",123)(45,Pe,9,1,"div",124),i(46,"button",125),u("click",function(){m(e);let n=d();return x(n.finalizarReserva())}),v(47,We,2,0,"span",126)(48,je,2,0,"span",127)(49,Le,2,0,"span",128),t(),i(50,"button",129),u("click",function(){m(e);let n=d();return x(n.step=2)}),r(51," Volver "),t()()()()}if(o&2){let e=d();l(8),_("Habitaci\xF3n (",e.daysDiff," noches)"),l(2),_("S/. ",E(11,17,e.calculateRoomTotal(),"1.2-2"),""),l(6),_("S/. ",E(17,20,e.calculateServicesTotal(),"1.2-2"),""),l(2),s("ngIf",e.discountAmount>0),l(5),b("ngModel",e.promoCode),l(3),s("ngIf",e.activeDiscount),l(),s("ngIf",e.promoCode&&!e.activeDiscount&&e.discountAmount===0),l(5),_("S/. ",E(33,23,e.calculateGrandTotal(),"1.2-2"),""),l(6),s("ngClass",S(26,M,e.paymentMethod==="TARJETA",e.paymentMethod!=="TARJETA")),l(2),s("ngClass",S(29,M,e.paymentMethod==="EFECTIVO",e.paymentMethod!=="EFECTIVO")),l(2),s("ngClass",S(32,M,e.paymentMethod==="WALLET",e.paymentMethod!=="WALLET")),l(2),s("ngIf",e.paymentMethod==="TARJETA"),l(),s("ngIf",e.paymentMethod==="WALLET"),l(),s("disabled",e.loading),l(),s("ngIf",e.loading),l(),s("ngIf",!e.loading),l(),s("ngIf",!e.loading)}}var it=(()=>{class o{formatCardNumber(e){let a=e.target.value.replace(/\D/g,"").substring(0,16),n="";for(let c=0;c<a.length;c++)c>0&&c%4===0&&(n+=" "),n+=a[c];this.paymentData.cardNumber=n,e.target.value=n}formatExpiry(e){let a=e.target.value.replace(/\D/g,"").substring(0,4),n=a;a.length>=2&&(n=a.substring(0,2)+"/"+a.substring(2)),this.paymentData.expiry=n,e.target.value=n}formatCVV(e){let a=e.target.value.replace(/\D/g,"").substring(0,3);this.paymentData.cvv=a,e.target.value=a}get daysDiff(){if(!this.reserva.fechaInicio||!this.reserva.fechaFin)return 0;let e=new Date(this.reserva.fechaInicio),a=new Date(this.reserva.fechaFin),n=Math.abs(a.getTime()-e.getTime());return Math.ceil(n/(1e3*60*60*24))||1}constructor(e,a,n,c,V,le,se,ce){this.reservaService=e,this.clienteService=a,this.habitacionService=n,this.servicioService=c,this.descuentoService=V,this.router=le,this.route=se,this.authService=ce,this.reserva={clienteId:null,habitacionId:null,fechaInicio:"",fechaFin:"",horaEntrada:"14:00",horaSalida:"12:00",total:0},this.step=1,this.loading=!1,this.error=null,this.success=null,this.clientes=[],this.selectedCliente=null,this.searchTermCliente="",this.habitacionesDisponibles=[],this.selectedHabitacion=null,this.servicios=[],this.selectedServices=new Map,this.promoCode="",this.discountAmount=0,this.activeDiscount=null,this.descuentos=[],this.paymentMethod="TARJETA",this.paymentData={cardNumber:"",expiry:"",cvv:"",holderName:"",walletPhone:""},this.selectedRoomType=null,this.filteredRooms=[],this.isAdmin$=this.authService.isAdmin$,this.isRecepcionista$=this.authService.isRecepcionista$,this.isCliente$=this.authService.isCliente$}ngOnInit(){this.servicioService.getAll().subscribe(e=>this.servicios=e),this.descuentoService.getAll().subscribe(e=>this.descuentos=e),this.isCliente$.subscribe(e=>{e&&this.clienteService.getProfile().subscribe({next:a=>{this.seleccionarCliente(a)},error:a=>{console.error("Error loading profile:",a),this.error="No se pudieron cargar sus datos de cliente. Intente recargar la p\xE1gina."}})}),this.route.queryParams.subscribe(e=>{e.idCliente&&this.clienteService.getById(+e.idCliente).subscribe({next:a=>this.seleccionarCliente(a)}),e.habitacionId&&(this.reserva.habitacionId=+e.habitacionId),e.fechaInicio&&(this.reserva.fechaInicio=e.fechaInicio),e.fechaFin&&(this.reserva.fechaFin=e.fechaFin),this.reserva.fechaInicio&&this.reserva.fechaFin&&this.reserva.habitacionId&&this.checkAvailability()})}buscarCliente(){this.searchTermCliente.length<3||this.clienteService.buscar(this.searchTermCliente).subscribe(e=>{e.length===1?this.seleccionarCliente(e[0]):(this.clientes=e,e.length>1&&(this.error="Se encontraron m\xFAltiples clientes. Refine la b\xFAsqueda."))})}seleccionarCliente(e){this.selectedCliente=e,this.reserva.clienteId=e.id,this.clientes=[],this.searchTermCliente="",this.error=null}checkAvailability(){this.reserva.habitacionId=null,this.selectedHabitacion=null,this.selectedRoomType=null,this.filteredRooms=[],this.reserva.fechaInicio&&this.reserva.fechaFin&&(this.loading=!0,this.error=null,this.habitacionesDisponibles=[],this.habitacionService.getDisponibles(this.reserva.fechaInicio,this.reserva.fechaFin).subscribe({next:e=>{this.habitacionesDisponibles=e,this.loading=!1},error:e=>{console.error("Error fetching available rooms:",e),this.habitacionesDisponibles=[],this.error="No se pudo verificar la disponibilidad. Aseg\xFArese de que el servidor est\xE9 activo y reiniciado si hubo cambios recientes.",this.loading=!1}}))}filterRoomsByType(e){if(!this.habitacionesDisponibles||this.habitacionesDisponibles.length===0){this.error="Seleccione fechas primero o no hay habitaciones disponibles.";return}this.selectedRoomType=e,this.reserva.habitacionId=null,this.selectedHabitacion=null,this.filteredRooms=this.habitacionesDisponibles.filter(a=>a.tipo.toUpperCase()===e.toUpperCase()),this.filteredRooms.length===0?this.error=`No hay habitaciones del tipo ${e} disponibles para estas fechas.`:this.error=null}onRoomNumberSelect(){if(this.reserva.habitacionId){let e=this.habitacionesDisponibles.find(a=>a.id==this.reserva.habitacionId);this.selectedHabitacion=e||null}}getSelectedRoomPrice(){return this.selectedHabitacion?this.selectedHabitacion.precioPorNoche:0}goToStep2(){this.selectedCliente&&this.reserva.habitacionId&&this.reserva.fechaInicio&&this.reserva.fechaFin?(this.step=2,window.scrollTo(0,0)):this.error="Complete todos los campos obligatorios."}getQuantity(e){return this.selectedServices.get(e)||0}updateServiceQuantity(e,a){let n=this.selectedServices.get(e.id)||0,c=Math.max(0,n+a);c>0?this.selectedServices.set(e.id,c):this.selectedServices.delete(e.id)}goToStep3(){this.step=3,window.scrollTo(0,0),this.calculateDiscount()}calculateRoomTotal(){return this.selectedHabitacion?this.selectedHabitacion.precioPorNoche*this.daysDiff:0}calculateServicesTotal(){let e=0;return this.selectedServices.forEach((a,n)=>{let c=this.servicios.find(V=>V.id===n);c&&(e+=c.precio*a)}),e}calculateDiscount(){if(this.discountAmount=0,this.activeDiscount=null,this.promoCode){let e=this.descuentos.find(a=>a.codigo===this.promoCode&&a.activo);if(e){let a=this.calculateRoomTotal()+this.calculateServicesTotal();e.tipo==="PORCENTAJE"?this.discountAmount=a*(e.valor/100):this.discountAmount=e.valor,this.activeDiscount=e}}}calculateGrandTotal(){return Math.max(0,this.calculateRoomTotal()+this.calculateServicesTotal()-this.discountAmount)}finalizarReserva(){this.loading=!0;let e={cliente:{id:this.reserva.clienteId},habitacion:{id:this.reserva.habitacionId},fechaInicio:this.reserva.fechaInicio,fechaFin:this.reserva.fechaFin,horaEntrada:this.reserva.horaEntrada||"14:00",horaSalida:this.reserva.horaSalida||"12:00",estadoReserva:"PENDIENTE",totalPagar:this.calculateRoomTotal(),montoDescuento:this.discountAmount,servicios:Array.from(this.selectedServices.keys()).map(a=>({id:a}))};this.activeDiscount&&(e.descuento={id:this.activeDiscount.id}),this.reservaService.create(e).subscribe({next:a=>{this.success="Reserva creada con \xE9xito.",this.loading=!1,setTimeout(()=>{this.isCliente$.subscribe(n=>{n?this.router.navigate(["/cliente/dashboard"]):this.router.navigate(["/reservas"])})},1500)},error:a=>{console.error(a),this.error="Error al crear la reserva. "+(a.error?.message||""),this.loading=!1}})}static{this.\u0275fac=function(a){return new(a||o)(w(ie),w(oe),w(ne),w(re),w(ae),w(J),w(O),w(Q))}}static{this.\u0275cmp=D({type:o,selectors:[["app-reserva-form"]],standalone:!0,features:[N],decls:16,vars:18,consts:[[3,"ngClass"],["class","sticky top-0 h-screen z-30 shrink-0",4,"ngIf"],[1,"flex-1","flex","flex-col","min-w-0","relative"],["class","h-20 border-b border-white/5 bg-[#121212] flex items-center justify-between px-8 sticky top-0 z-20",4,"ngIf"],[1,"p-8"],[1,"max-w-6xl","mx-auto"],["class","flex items-center justify-center mb-8 gap-4",4,"ngIf"],["class","mb-6 p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 font-bold flex items-center gap-2 animate-fade-in",4,"ngIf"],["class","grid grid-cols-1 lg:grid-cols-2 gap-8 animate-fade-in",4,"ngIf"],["class","max-w-4xl mx-auto animate-fade-in",4,"ngIf"],[1,"sticky","top-0","h-screen","z-30","shrink-0"],[1,"h-20","border-b","border-white/5","bg-[#121212]","flex","items-center","justify-between","px-8","sticky","top-0","z-20"],[1,"text-2xl","font-bold","text-white","tracking-tight"],["class","flex items-center gap-2 text-xs text-white/50",4,"ngIf"],[1,"flex","items-center","gap-2","text-xs","text-white/50"],["routerLink","/recepcion",1,"hover:text-primary","transition-colors"],[1,"material-symbols-outlined","text-[10px]"],["routerLink","/catalogo",1,"hover:text-primary","transition-colors"],[1,"flex","items-center","justify-center","mb-8","gap-4"],[1,"flex","items-center","gap-2",3,"ngClass"],[1,"w-8","h-8","rounded-full","border-2","flex","items-center","justify-center","font-bold",3,"ngClass"],[1,"font-bold","text-sm"],[1,"w-12","h-px","bg-white/10"],[1,"mb-6","p-4","rounded-xl","bg-red-500/10","border","border-red-500/20","text-red-400","font-bold","flex","items-center","gap-2","animate-fade-in"],[1,"material-symbols-outlined"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8","animate-fade-in"],[1,"space-y-6"],[1,"bg-[#1A1A1A]","border","border-white/5","rounded-2xl","p-6"],[1,"flex","items-center","gap-3","mb-6"],[1,"material-symbols-outlined","text-primary","text-xl"],[1,"text-lg","font-bold","text-white"],["class","relative mb-6",4,"ngIf"],["class","bg-primary/10 border border-primary/20 rounded-xl p-4 flex items-center gap-4 animate-fade-in",4,"ngIf"],["class","p-4 text-center text-white/50",4,"ngIf"],["class","p-8 border-2 border-dashed border-white/5 rounded-xl flex flex-col items-center justify-center text-center gap-4 hover:border-white/10 transition-colors",4,"ngIf"],[1,"bg-transparent"],[1,"grid","grid-cols-2","gap-6"],[1,"space-y-2"],[1,"text-[10px]","font-bold","text-white/40","uppercase","tracking-widest"],[1,"relative","group"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","pointer-events-none"],[1,"material-symbols-outlined","text-white/40","group-focus-within:text-white","transition-colors","text-lg"],["type","date",1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","pl-10","pr-4","py-3.5","text-white","text-sm","placeholder:text-white/20","focus:border-green-500","focus:outline-none","transition-all",3,"ngModelChange","change","ngModel"],[1,"relative"],[1,"material-symbols-outlined","text-white/40","text-lg"],["type","time",1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","pl-10","pr-4","py-3.5","text-white","text-sm","focus:outline-none","focus:border-green-500","transition-all","placeholder:text-white/20",3,"ngModelChange","ngModel"],[1,"text-[10px]","text-white/30"],[1,"space-y-3","pt-2"],["class","text-sm text-primary flex items-center gap-2 mb-2",4,"ngIf"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-4"],[1,"cursor-pointer","bg-[#1A1A1A]","border","rounded-lg","p-5","flex","flex-col","justify-between","h-32","hover:border-white/20","transition-all","relative","overflow-hidden","group",3,"click","ngClass"],[1,"material-symbols-outlined","text-2xl","text-white/50","group-hover:text-[#00A67E]","transition-colors"],[1,"text-sm","font-bold","text-white"],[1,"text-[10px]","text-white/40"],["class","absolute top-2 right-2 text-[#00A67E] animate-fade-in",4,"ngIf"],["class","space-y-3 pt-6 animate-fade-in",4,"ngIf"],[1,"w-full","mt-6","py-4","bg-[#00A67E]","hover:bg-[#008f6d]","text-white","rounded-lg","font-bold","text-sm","transition-all","flex","justify-center","items-center","gap-2","disabled:opacity-50","disabled:cursor-not-allowed","shadow-lg","shadow-[#00A67E]/20",3,"click","disabled"],[1,"relative","mb-6"],[1,"flex","gap-2"],[1,"relative","flex-1"],[1,"absolute","inset-y-0","left-0","pl-3","flex","items-center","text-white/30"],["type","text","placeholder","Ingrese DNI del cliente",1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","pl-10","pr-4","py-3","text-white","focus:border-primary","transition-colors",3,"ngModelChange","keyup.enter","ngModel"],[1,"px-4","bg-white/5","text-white","rounded-lg","hover:bg-white/10","border","border-white/5",3,"click"],[1,"bg-primary/10","border","border-primary/20","rounded-xl","p-4","flex","items-center","gap-4","animate-fade-in"],[1,"size-12","rounded-full","bg-primary/20","flex","items-center","justify-center","text-primary","font-bold","text-lg"],[1,"text-white","font-bold","text-lg"],[1,"text-white/60","text-sm"],["class","ml-auto text-white/40 hover:text-red-400 transition-colors",3,"click",4,"ngIf"],[1,"ml-auto","text-white/40","hover:text-red-400","transition-colors",3,"click"],[1,"p-4","text-center","text-white/50"],[1,"material-symbols-outlined","animate-spin","mr-2"],[1,"p-8","border-2","border-dashed","border-white/5","rounded-xl","flex","flex-col","items-center","justify-center","text-center","gap-4","hover:border-white/10","transition-colors"],[1,"material-symbols-outlined","text-4xl","text-white/20"],[1,"text-white/40","text-sm"],["routerLink","/clientes/crear",1,"text-primary","text-sm","font-bold","hover:underline"],[1,"text-sm","text-primary","flex","items-center","gap-2","mb-2"],[1,"material-symbols-outlined","animate-spin","text-sm"],[1,"absolute","top-2","right-2","text-[#00A67E]","animate-fade-in"],[1,"material-symbols-outlined","text-lg"],[1,"space-y-3","pt-6","animate-fade-in"],[1,"text-[10px]","font-bold","text-white/40","uppercase","tracking-widest","pl-1"],[1,"absolute","inset-y-0","left-0","pl-4","flex","items-center","pointer-events-none","text-white/30"],[1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","pl-12","pr-10","py-4","text-white","text-sm","focus:border-primary","focus:outline-none","appearance-none","cursor-pointer","hover:border-white/20","transition-colors",3,"ngModelChange","change","ngModel"],["disabled","","selected","",3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],["disabled","",4,"ngIf"],[1,"absolute","inset-y-0","right-0","pr-4","flex","items-center","pointer-events-none","text-white/30"],["class","text-xs text-[#00A67E] pl-1 font-bold animate-fade-in",4,"ngIf"],[3,"ngValue"],["disabled",""],[1,"text-xs","text-[#00A67E]","pl-1","font-bold","animate-fade-in"],[1,"material-symbols-outlined","text-xs","align-middle","mr-1"],[1,"max-w-4xl","mx-auto","animate-fade-in"],[1,"text-xl","font-bold","text-white","mb-6"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4","mb-8"],["class","bg-[#1A1A1A] border border-white/5 p-4 rounded-xl flex flex-col justify-between hover:border-primary/50 transition-colors",4,"ngFor","ngForOf"],[1,"flex","justify-between"],[1,"px-6","py-3","text-white/50","hover:text-white","font-bold",3,"click"],[1,"px-8","py-3","bg-primary","text-[#121212]","rounded-lg","font-bold","hover:bg-primary/90",3,"click"],[1,"bg-[#1A1A1A]","border","border-white/5","p-4","rounded-xl","flex","flex-col","justify-between","hover:border-primary/50","transition-colors"],[1,"font-bold","text-white"],[1,"text-xs","text-white/50","mb-2"],[1,"text-primary","font-bold"],[1,"mt-4","flex","items-center","justify-between","bg-[#121212]","rounded-lg","p-1"],[1,"w-8","h-8","flex","items-center","justify-center","text-white/60","hover:text-white","hover:bg-white/10","rounded",3,"click"],[1,"material-symbols-outlined","text-sm"],[1,"font-mono","text-white","text-sm"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"bg-[#1A1A1A]","border","border-white/5","rounded-2xl","p-6","h-fit"],[1,"text-lg","font-bold","text-white","mb-4"],[1,"space-y-3","text-sm","text-white/70","mb-6","pb-6","border-b","border-white/5"],["class","flex justify-between text-green-400",4,"ngIf"],[1,"mt-4","pt-4","border-t","border-white/5"],[1,"text-xs","font-bold","text-white/40","uppercase","block","mb-2"],["type","text","placeholder","Ingrese c\xF3digo",1,"flex-1","bg-[#121212]","border","border-white/10","rounded-lg","px-3","py-2","text-white","text-sm","focus:border-primary","focus:outline-none","uppercase",3,"ngModelChange","ngModel"],[1,"px-3","py-2","bg-white/5","hover:bg-white/10","text-white","text-xs","font-bold","rounded-lg","border","border-white/5","transition-colors",3,"click"],["class","text-xs text-green-400 mt-2 flex items-center gap-1",4,"ngIf"],["class","text-xs text-red-400 mt-2",4,"ngIf"],[1,"flex","justify-between","items-center","text-xl","font-bold","text-white"],[1,"text-primary"],[1,"text-lg","font-bold","text-white","mb-6"],[1,"flex","gap-2","mb-6","bg-[#121212]","p-1","rounded-lg"],[1,"flex-1","py-2","text-sm","font-bold","rounded-md","transition-colors",3,"click","ngClass"],["class","space-y-4 animate-fade-in",4,"ngIf"],["class","space-y-4 animate-fade-in text-center py-4",4,"ngIf"],[1,"w-full","mt-6","py-4","bg-green-500","text-[#121212]","rounded-lg","font-bold","hover:bg-green-400","transition-all","flex","justify-center","items-center","gap-2","disabled:opacity-50",3,"click","disabled"],["class","material-symbols-outlined animate-spin",4,"ngIf"],[4,"ngIf"],["class","material-symbols-outlined",4,"ngIf"],[1,"w-full","mt-2","py-3","text-white/40","hover:text-white","font-bold","text-sm",3,"click"],[1,"flex","justify-between","text-green-400"],[1,"text-xs","text-green-400","mt-2","flex","items-center","gap-1"],[1,"material-symbols-outlined","text-xs"],[1,"text-xs","text-red-400","mt-2"],[1,"space-y-4","animate-fade-in"],[1,"space-y-1"],[1,"text-xs","uppercase","font-bold","text-white/40"],["type","text","placeholder","0000 0000 0000 0000","maxlength","19",1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","px-4","py-3","text-white","text-sm",3,"input","ngModel"],[1,"flex","gap-4"],[1,"space-y-1","flex-1"],["type","text","placeholder","MM/AA","maxlength","5",1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","px-4","py-3","text-white","text-sm",3,"input","ngModel"],[1,"space-y-1","w-24"],["type","text","placeholder","123","maxlength","3",1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","px-4","py-3","text-white","text-sm",3,"input","ngModel"],["type","text","placeholder","Nombre como figura en tarjeta",1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","px-4","py-3","text-white","text-sm",3,"ngModelChange","ngModel"],[1,"space-y-4","animate-fade-in","text-center","py-4"],[1,"text-xl","font-bold","text-white"],[1,"space-y-1","text-left"],["type","text","placeholder","N\xFAmero de confirmaci\xF3n","maxlength","9","onkeypress","return event.charCode >= 48 && event.charCode <= 57",1,"w-full","bg-[#121212]","border","border-white/10","rounded-lg","px-4","py-3","text-white","text-sm",3,"ngModelChange","ngModel"],[1,"material-symbols-outlined","animate-spin"]],template:function(a,n){a&1&&(i(0,"div",0),h(1,"async"),v(2,de,2,0,"div",1),h(3,"async"),h(4,"async"),i(5,"div",2),v(6,xe,10,8,"header",3),h(7,"async"),i(8,"main",4)(9,"div",5),v(10,ue,18,30,"div",6),h(11,"async"),v(12,ve,4,1,"div",7)(13,Ve,103,25,"div",8)(14,ke,10,1,"div",9)(15,He,52,35,"div",9),t()()()()),a&2&&(s("ngClass",f(1,8,n.isCliente$)?"w-full":"flex min-h-screen w-full bg-[#121212] font-display text-gray-100"),l(2),s("ngIf",f(3,10,n.isAdmin$)||f(4,12,n.isRecepcionista$)),l(4),s("ngIf",!f(7,14,n.isCliente$)),l(4),s("ngIf",!f(11,16,n.isCliente$)),l(2),s("ngIf",n.error),l(),s("ngIf",n.step===1),l(),s("ngIf",n.step===2),l(),s("ngIf",n.step===3))},dependencies:[H,B,P,W,j,L,ee,K,X,q,Y,G,Z,U,$,z,te],encapsulation:2})}}return o})();export{it as ReservaFormComponent};
