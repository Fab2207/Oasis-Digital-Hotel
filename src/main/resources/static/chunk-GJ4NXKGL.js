import{d as P}from"./chunk-VPD64DAD.js";import"./chunk-HDTJ3KOH.js";import{a as $}from"./chunk-YG3CPSL3.js";import{b as j,c as O,f as z,s as L}from"./chunk-SW222O52.js";import{$ as S,Ba as V,D as l,E as g,H as b,J as c,Ka as D,N as t,O as i,Oa as N,P as h,S as v,T as u,U as s,X as n,Y as w,Z as f,a as C,aa as R,b as y,ba as I,da as k,ea as M,q as E,sa as A,ta as F,u as p,ua as T,v as x,za as H}from"./chunk-DBIQ3VVQ.js";var U=()=>[1,2,3,4,5];function Z(o,m){o&1&&(t(0,"div",16)(1,"div",17)(2,"span",18),n(3,"schedule"),i()(),t(4,"h3",19),n(5,"No hay historial"),i(),t(6,"p",20),n(7,"A\xFAn no has realizado ninguna reserva."),i(),t(8,"a",21),n(9," Hacer una Reserva "),i()())}function G(o,m){if(o&1){let e=v();t(0,"button",42),u("click",function(){p(e);let a=s().$implicit,d=s(2);return x(d.openReviewModal(a))}),t(1,"span",9),n(2,"star"),i()()}}function J(o,m){if(o&1){let e=v();t(0,"button",43),u("click",function(){p(e);let a=s().$implicit,d=s(2);return x(d.cancelar(a))}),t(1,"span",9),n(2,"cancel"),i()()}}function K(o,m){if(o&1){let e=v();t(0,"tr",30)(1,"td",31),n(2),i(),t(3,"td",32)(4,"div",33),n(5),i(),t(6,"div",34),n(7),i()(),t(8,"td",35),n(9),i(),t(10,"td",35),n(11),i(),t(12,"td",36),n(13),i(),t(14,"td",32)(15,"span",37),n(16),i()(),t(17,"td",38)(18,"button",39),u("click",function(){let a=p(e).$implicit,d=s(2);return x(d.viewDetails(a))}),t(19,"span",9),n(20,"visibility"),i()(),b(21,G,3,0,"button",40)(22,J,3,0,"button",41),i()()}if(o&2){let e=m.$implicit,r=s(2);l(2),f("#",e.id,""),l(3),f("Hab. ",e.habitacionNumero,""),l(2),w(e.habitacionTipo),l(2),w(e.fechaInicio),l(2),w(e.fechaFin),l(2),f("$",e.total,""),l(2),c("ngClass",r.getEstadoClass(e.estado)),l(),f(" ",e.estado," "),l(5),c("ngIf",e.estado==="FINALIZADA"),l(),c("ngIf",r.isCancelable(e))}}function Q(o,m){if(o&1&&(t(0,"div",22)(1,"div",23)(2,"table",24)(3,"thead")(4,"tr",25)(5,"th",26),n(6,"ID"),i(),t(7,"th",26),n(8,"Habitaci\xF3n"),i(),t(9,"th",26),n(10,"Fecha Entrada"),i(),t(11,"th",26),n(12,"Fecha Salida"),i(),t(13,"th",26),n(14,"Total"),i(),t(15,"th",26),n(16,"Estado"),i(),t(17,"th",27),n(18,"Acciones"),i()()(),t(19,"tbody",28),b(20,K,23,10,"tr",29),i()()()()),o&2){let e=s();l(20),c("ngForOf",e.reservas)}}function X(o,m){o&1&&(t(0,"div",44),h(1,"div",45),i())}function Y(o,m){if(o&1){let e=v();t(0,"button",61),u("click",function(){let a=p(e).$implicit,d=s(2);return x(d.setRating(a))}),t(1,"span",62),n(2,"star"),i()()}if(o&2){let e=m.$implicit,r=s(2);l(),c("ngClass",e<=r.reviewRating?"text-amber-400 fill-current":"text-white/20")}}function ee(o,m){o&1&&(t(0,"span",63),n(1,"refresh"),i())}function te(o,m){if(o&1){let e=v();t(0,"div",46)(1,"div",47)(2,"button",48),u("click",function(){p(e);let a=s();return x(a.closeReviewModal())}),t(3,"span",49),n(4,"close"),i()(),t(5,"div",50)(6,"h3",51),n(7,"Calificar Estancia"),i(),t(8,"p",6),n(9),i()(),t(10,"div",52),b(11,Y,3,1,"button",53),i(),t(12,"div",54)(13,"label",55),n(14,"Su experiencia"),i(),t(15,"textarea",56),I("ngModelChange",function(a){p(e);let d=s();return R(d.reviewComment,a)||(d.reviewComment=a),x(a)}),i()(),t(16,"div",57)(17,"button",58),u("click",function(){p(e);let a=s();return x(a.closeReviewModal())}),n(18," Cancelar "),i(),t(19,"button",59),u("click",function(){p(e);let a=s();return x(a.submitReview())}),b(20,ee,2,0,"span",60),t(21,"span"),n(22,"Enviar Rese\xF1a"),i()()()()()}if(o&2){let e=s();l(9),f("Habitaci\xF3n ",e.selectedReservaForReview==null?null:e.selectedReservaForReview.habitacionNumero,""),l(2),c("ngForOf",M(5,U)),l(4),S("ngModel",e.reviewComment),l(4),c("disabled",e.submittingReview),l(),c("ngIf",e.submittingReview)}}function ie(o,m){if(o&1){let e=v();t(0,"div",64)(1,"div",65)(2,"button",66),u("click",function(){p(e);let a=s();return x(a.closeDetailModal())}),t(3,"span",49),n(4,"close"),i()(),t(5,"div",67),h(6,"app-client-reserva-detail",68),i()()()}if(o&2){let e=s();l(6),c("reservaInput",e.activeReservaForModal)("isModal",!0)}}var xe=(()=>{class o{constructor(e,r){this.reservaService=e,this.http=r,this.reservas=[],this.loading=!0,this.showDetailModal=!1,this.activeReservaForModal=null,this.showReviewModal=!1,this.selectedReservaForReview=null,this.reviewRating=5,this.reviewComment="",this.submittingReview=!1}ngOnInit(){this.reservaService.getMisReservas().subscribe({next:e=>{this.reservas=e.map(r=>{let a=0;r.servicios&&Array.isArray(r.servicios)&&(a=r.servicios.reduce((q,B)=>{let _=B.split(" - S/.");return q+(_.length===2?parseFloat(_[1]):0)},0));let d=(r.habitacionPrecio||0)*(r.diasEstadia||1),W=Math.max(0,d+a-(r.montoDescuento||0));return y(C({},r),{estado:r.estado||r.estadoReserva,total:W})}),this.loading=!1},error:()=>this.loading=!1})}viewDetails(e){this.activeReservaForModal=e,this.showDetailModal=!0}closeDetailModal(){this.showDetailModal=!1,this.activeReservaForModal=null}getEstadoClass(e){switch(e.toUpperCase()){case"PENDIENTE":return"bg-yellow-500/10 text-yellow-400 border-yellow-500/30";case"CONFIRMADA":return"bg-blue-500/10 text-blue-400 border-blue-500/30";case"ACTIVA":return"bg-green-500/10 text-green-400 border-green-500/30";case"FINALIZADA":return"bg-gray-500/10 text-gray-400 border-gray-500/30";case"CANCELADA":return"bg-red-500/10 text-red-400 border-red-500/30";default:return"bg-white/10 text-white border-white/20"}}isCancelable(e){return e.estado==="PENDIENTE"||e.estado==="CONFIRMADA"}cancelar(e){confirm("\xBFEst\xE1 seguro que desea cancelar esta reserva?")&&this.reservaService.cancelar(e.id).subscribe(()=>{this.ngOnInit()})}openReviewModal(e){this.selectedReservaForReview=e,this.reviewRating=5,this.reviewComment="",this.showReviewModal=!0}closeReviewModal(){this.showReviewModal=!1,this.selectedReservaForReview=null}setRating(e){this.reviewRating=e}submitReview(){if(!this.selectedReservaForReview)return;this.submittingReview=!0;let e={reserva:{id:this.selectedReservaForReview.id},calificacion:this.reviewRating,comentario:this.reviewComment,fecha:new Date().toISOString().split("T")[0]};this.http.post(`${N.apiUrl}/resenas`,e).subscribe({next:()=>{this.submittingReview=!1,alert("\xA1Gracias por tu calificaci\xF3n!"),this.closeReviewModal()},error:r=>{this.submittingReview=!1,console.error(r),alert("Error al enviar rese\xF1a: "+(r.error?.message||r.statusText))}})}static{this.\u0275fac=function(r){return new(r||o)(g($),g(V))}}static{this.\u0275cmp=E({type:o,selectors:[["app-client-history"]],standalone:!0,features:[k],decls:23,vars:5,consts:[[1,"space-y-6","animate-fade-in","text-white/90","font-sans"],[1,"flex","flex-col","gap-1"],[1,"flex","items-center","gap-2","text-xs","text-white/50","mb-4"],[1,"hover:text-primary","transition-colors","cursor-pointer"],[1,"material-symbols-outlined","text-[10px]"],[1,"text-3xl","font-bold","text-white","tracking-tight"],[1,"text-white/60","text-sm"],[1,"relative","w-full"],[1,"absolute","inset-y-0","left-0","flex","items-center","pl-4","text-white/30"],[1,"material-symbols-outlined","text-lg"],["type","text","placeholder","Buscar por fecha o ID de reserva...",1,"w-full","bg-[#121212]","border","border-white/5","rounded-xl","pl-12","pr-4","py-4","text-sm","text-white","focus:border-white/10","focus:outline-none","placeholder:text-white/20","transition-all"],["class","border-2 border-dashed border-white/10 rounded-xl p-12 flex flex-col items-center justify-center text-center bg-[#18181b]/50 min-h-[400px]",4,"ngIf"],["class","bg-[#1A1A1A] border border-white/5 rounded-2xl overflow-hidden shadow-2xl",4,"ngIf"],["class","flex justify-center py-20",4,"ngIf"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in",4,"ngIf"],["class","fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fade-in",4,"ngIf"],[1,"border-2","border-dashed","border-white/10","rounded-xl","p-12","flex","flex-col","items-center","justify-center","text-center","bg-[#18181b]/50","min-h-[400px]"],[1,"w-16","h-16","rounded-full","bg-white/5","flex","items-center","justify-center","mb-4"],[1,"material-symbols-outlined","text-3xl","text-white/20"],[1,"text-lg","font-bold","text-white","mb-2"],[1,"text-white/40","text-sm","mb-8"],["routerLink","/reservas/crear",1,"px-6","py-3","bg-[#00A67E]","hover:bg-[#008f6d]","text-white","text-sm","font-bold","rounded-lg","transition-colors","shadow-lg","shadow-[#00A67E]/20"],[1,"bg-[#1A1A1A]","border","border-white/5","rounded-2xl","overflow-hidden","shadow-2xl"],[1,"overflow-x-auto"],[1,"w-full","text-left","text-sm"],[1,"border-b","border-white/5","text-white/40","uppercase","tracking-wider","text-xs","bg-white/[0.02]"],[1,"px-6","py-4","font-bold"],[1,"px-6","py-4","font-bold","text-center"],[1,"divide-y","divide-white/5"],["class","hover:bg-white/[0.02] transition-colors group",4,"ngFor","ngForOf"],[1,"hover:bg-white/[0.02]","transition-colors","group"],[1,"px-6","py-4","text-white/50","font-mono"],[1,"px-6","py-4"],[1,"font-bold","text-white"],[1,"text-xs","text-white/50"],[1,"px-6","py-4","text-white"],[1,"px-6","py-4","font-bold","text-white","text-lg"],[1,"px-3","py-1","rounded-full","text-[10px]","font-bold","border",3,"ngClass"],[1,"px-6","py-4","flex","justify-center","gap-2","opacity-60","group-hover:opacity-100","transition-opacity"],["title","Ver Detalles/Servicios",1,"p-2","bg-white/5","hover:bg-white/20","rounded-lg","text-white","transition-colors",3,"click"],["class","p-2 bg-amber-500/10 hover:bg-amber-500/30 text-amber-400 rounded-lg transition-colors border border-amber-500/20","title","Calificar Estancia",3,"click",4,"ngIf"],["class","p-2 bg-red-500/10 hover:bg-red-500/30 text-red-400 rounded-lg transition-colors","title","Cancelar Reserva",3,"click",4,"ngIf"],["title","Calificar Estancia",1,"p-2","bg-amber-500/10","hover:bg-amber-500/30","text-amber-400","rounded-lg","transition-colors","border","border-amber-500/20",3,"click"],["title","Cancelar Reserva",1,"p-2","bg-red-500/10","hover:bg-red-500/30","text-red-400","rounded-lg","transition-colors",3,"click"],[1,"flex","justify-center","py-20"],[1,"animate-spin","rounded-full","h-12","w-12","border-t-2","border-primary"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/80","backdrop-blur-sm","p-4","animate-fade-in"],[1,"bg-[#1A1A1A]","border","border-white/5","rounded-2xl","p-6","w-full","max-w-md","shadow-2xl","relative"],[1,"absolute","top-4","right-4","text-white/30","hover:text-white","transition-colors",3,"click"],[1,"material-symbols-outlined"],[1,"text-center","mb-6"],[1,"text-xl","font-bold","text-white","mb-2"],[1,"flex","justify-center","gap-2","mb-6"],["class","transition-transform hover:scale-110 focus:outline-none",3,"click",4,"ngFor","ngForOf"],[1,"mb-6"],[1,"block","text-xs","font-bold","text-white/40","uppercase","mb-2"],["rows","4","placeholder","Cu\xE9ntenos qu\xE9 le pareci\xF3...",1,"w-full","bg-[#121212]","border","border-white/10","rounded-xl","p-4","text-white","text-sm","focus:border-amber-400/50","focus:outline-none","resize-none",3,"ngModelChange","ngModel"],[1,"flex","gap-4"],[1,"flex-1","py-3","bg-white/5","hover:bg-white/10","text-white","font-bold","rounded-xl","transition-colors",3,"click"],[1,"flex-1","py-3","bg-amber-500","hover:bg-amber-400","text-[#121212]","font-bold","rounded-xl","transition-colors","disabled:opacity-50","flex","justify-center","gap-2",3,"click","disabled"],["class","material-symbols-outlined animate-spin text-sm",4,"ngIf"],[1,"transition-transform","hover:scale-110","focus:outline-none",3,"click"],[1,"material-symbols-outlined","text-4xl",3,"ngClass"],[1,"material-symbols-outlined","animate-spin","text-sm"],[1,"fixed","inset-0","z-[60]","flex","items-center","justify-center","bg-black/80","backdrop-blur-sm","p-4","animate-fade-in"],[1,"bg-[#1A1A1A]","border","border-white/5","rounded-2xl","w-full","max-w-2xl","shadow-2xl","relative","max-h-[90vh]","overflow-y-auto"],[1,"absolute","top-4","right-4","text-white/60","hover:text-white","transition-colors","z-10","p-2","bg-black/20","rounded-full",3,"click"],[1,"p-2"],[3,"reservaInput","isModal"]],template:function(r,a){r&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),n(4,"Panel de Control"),i(),t(5,"span",4),n(6,"chevron_right"),i(),t(7,"span"),n(8,"Inicio"),i()(),t(9,"h1",5),n(10,"Historial de Reservas"),i(),t(11,"p",6),n(12,"Revise sus estancias pasadas y descargue sus facturas."),i()(),t(13,"div",7)(14,"span",8)(15,"span",9),n(16,"search"),i()(),h(17,"input",10),i(),b(18,Z,10,0,"div",11)(19,Q,21,1,"div",12)(20,X,2,0,"div",13)(21,te,23,6,"div",14)(22,ie,7,2,"div",15),i()),r&2&&(l(18),c("ngIf",a.reservas.length===0&&!a.loading),l(),c("ngIf",a.reservas.length>0),l(),c("ngIf",a.loading),l(),c("ngIf",a.showReviewModal),l(),c("ngIf",a.showDetailModal))},dependencies:[H,A,F,T,D,L,j,O,z,P],encapsulation:2})}}return o})();export{xe as ClientHistoryComponent};
